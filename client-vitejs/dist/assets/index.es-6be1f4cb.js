import{b as kt,V as mt,H as Oo,t as yt,$ as No,a3 as at,a4 as ct,a5 as wi,a6 as Li,a7 as Ln,a8 as Fn,a9 as Cn,aa as fs,ab as To,ac as Ao,ad as Mn,ae as Fi,af as Po,ag as Ci,ah as Mi,ai as Di,aj as Ct,ak as Pt,al as Dn,am as $i,an as $n}from"./index-598719e0.js";function Ro(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Uo=Lo;function Lo(t,e,r){var i=r&&r.stringify||Ro,s=1;if(typeof t=="object"&&t!==null){var o=e.length+s;if(o===1)return t;var u=new Array(o);u[0]=i(t);for(var c=1;c<o;c++)u[c]=i(e[c]);return u.join(" ")}if(typeof t!="string")return t;var h=e.length;if(h===0)return t;for(var m="",w=1-s,E=-1,P=t&&t.length||0,v=0;v<P;){if(t.charCodeAt(v)===37&&v+1<P){switch(E=E>-1?E:0,t.charCodeAt(v+1)){case 100:case 102:if(w>=h||e[w]==null)break;E<v&&(m+=t.slice(E,v)),m+=Number(e[w]),E=v+2,v++;break;case 105:if(w>=h||e[w]==null)break;E<v&&(m+=t.slice(E,v)),m+=Math.floor(Number(e[w])),E=v+2,v++;break;case 79:case 111:case 106:if(w>=h||e[w]===void 0)break;E<v&&(m+=t.slice(E,v));var N=typeof e[w];if(N==="string"){m+="'"+e[w]+"'",E=v+2,v++;break}if(N==="function"){m+=e[w].name||"<anonymous>",E=v+2,v++;break}m+=i(e[w]),E=v+2,v++;break;case 115:if(w>=h)break;E<v&&(m+=t.slice(E,v)),m+=String(e[w]),E=v+2,v++;break;case 37:E<v&&(m+=t.slice(E,v)),m+="%",E=v+2,v++,w--;break}++w}++v}return E===-1?t:(E<P&&(m+=t.slice(E)),m)}const ds=Uo;var Er=It;const mr=Ko().console||{},Fo={mapHttpRequest:Mr,mapHttpResponse:Mr,wrapRequestSerializer:si,wrapResponseSerializer:si,wrapErrorSerializer:si,req:Mr,res:Mr,err:jo};function Co(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function It(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||mr;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},s=Co(t.browser.serialize,i);let o=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(o=!1);const u=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const c=t.level||"info",h=Object.create(r);h.log||(h.log=br),Object.defineProperty(h,"levelVal",{get:w}),Object.defineProperty(h,"level",{get:E,set:P});const m={transmit:e,serialize:s,asObject:t.browser.asObject,levels:u,timestamp:zo(t)};h.levels=It.levels,h.level=c,h.setMaxListeners=h.getMaxListeners=h.emit=h.addListener=h.on=h.prependListener=h.once=h.prependOnceListener=h.removeListener=h.removeAllListeners=h.listeners=h.listenerCount=h.eventNames=h.write=h.flush=br,h.serializers=i,h._serialize=s,h._stdErrSerialize=o,h.child=v,e&&(h._logEvent=mi());function w(){return this.level==="silent"?1/0:this.levels.values[this.level]}function E(){return this._level}function P(N){if(N!=="silent"&&!this.levels.values[N])throw Error("unknown level "+N);this._level=N,er(m,h,"error","log"),er(m,h,"fatal","error"),er(m,h,"warn","error"),er(m,h,"info","log"),er(m,h,"debug","log"),er(m,h,"trace","log")}function v(N,C){if(!N)throw new Error("missing bindings for child Pino");C=C||{},s&&N.serializers&&(C.serializers=N.serializers);const R=C.serializers;if(s&&R){var $=Object.assign({},i,R),l=t.browser.serialize===!0?Object.keys($):s;delete N.serializers,kr([N],l,$,this._stdErrSerialize)}function _(f){this._childLevel=(f._childLevel|0)+1,this.error=tr(f,N,"error"),this.fatal=tr(f,N,"fatal"),this.warn=tr(f,N,"warn"),this.info=tr(f,N,"info"),this.debug=tr(f,N,"debug"),this.trace=tr(f,N,"trace"),$&&(this.serializers=$,this._serialize=l),e&&(this._logEvent=mi([].concat(f._logEvent.bindings,N)))}return _.prototype=this,new _(this)}return h}It.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};It.stdSerializers=Fo;It.stdTimeFunctions=Object.assign({},{nullTime:jn,epochTime:zn,unixTime:Ho,isoTime:qo});function er(t,e,r,i){const s=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?br:s[r]?s[r]:mr[r]||mr[i]||br,Mo(t,e,r)}function Mo(t,e,r){!t.transmit&&e[r]===br||(e[r]=function(i){return function(){const o=t.timestamp(),u=new Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===mr?mr:this;for(var h=0;h<u.length;h++)u[h]=arguments[h];if(t.serialize&&!t.asObject&&kr(u,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(c,Do(this,r,u,o)):i.apply(c,u),t.transmit){const m=t.transmit.level||e.level,w=It.levels.values[m],E=It.levels.values[r];if(E<w)return;$o(this,{ts:o,methodLevel:r,methodValue:E,transmitLevel:m,transmitValue:It.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},u)}}}(e[r]))}function Do(t,e,r,i){t._serialize&&kr(r,t._serialize,t.serializers,t._stdErrSerialize);const s=r.slice();let o=s[0];const u={};i&&(u.time=i),u.level=It.levels.values[e];let c=(t._childLevel|0)+1;if(c<1&&(c=1),o!==null&&typeof o=="object"){for(;c--&&typeof s[0]=="object";)Object.assign(u,s.shift());o=s.length?ds(s.shift(),s):void 0}else typeof o=="string"&&(o=ds(s.shift(),s));return o!==void 0&&(u.msg=o),u}function kr(t,e,r,i){for(const s in t)if(i&&t[s]instanceof Error)t[s]=It.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s]))for(const o in t[s])e&&e.indexOf(o)>-1&&o in r&&(t[s][o]=r[o](t[s][o]))}function tr(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return t[r].apply(this,i)}}function $o(t,e,r){const i=e.send,s=e.ts,o=e.methodLevel,u=e.methodValue,c=e.val,h=t._logEvent.bindings;kr(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(m){return h.indexOf(m)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=u,i(o,t._logEvent,c),t._logEvent=mi(h)}function mi(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function jo(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function zo(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?jn:zn}function Mr(){return{}}function si(t){return t}function br(){}function jn(){return!1}function zn(){return Date.now()}function Ho(){return Math.round(Date.now()/1e3)}function qo(){return new Date(Date.now()).toISOString()}function Ko(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}var Yr={},Sr={};Object.defineProperty(Sr,"__esModule",{value:!0});function Bo(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}Sr.safeJsonParse=Bo;function Vo(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}Sr.safeJsonStringify=Vo;var Hr={},ni={get exports(){return Hr},set exports(t){Hr=t}},gs;function Go(){return gs||(gs=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof kt<"u"&&kt.localStorage?ni.exports=kt.localStorage:typeof window<"u"&&window.localStorage?ni.exports=window.localStorage:ni.exports=new e}()),Hr}var ai={},ur={},ps;function Wo(){if(ps)return ur;ps=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.IKeyValueStorage=void 0;class t{}return ur.IKeyValueStorage=t,ur}var lr={},ys;function ko(){if(ys)return lr;ys=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.parseEntry=void 0;const t=Sr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return lr.parseEntry=e,lr}var _s;function Yo(){return _s||(_s=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(Wo(),t),e.__exportStar(ko(),t)}(ai)),ai}Object.defineProperty(Yr,"__esModule",{value:!0});Yr.KeyValueStorage=void 0;const ir=mt,ws=Sr,Jo=ir.__importDefault(Go()),Xo=Yo();class Hn{constructor(){this.localStorage=Jo.default}getKeys(){return ir.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return ir.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Xo.parseEntry)})}getItem(e){return ir.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return ws.safeJsonParse(r)})}setItem(e,r){return ir.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,ws.safeJsonStringify(r))})}removeItem(e){return ir.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Yr.KeyValueStorage=Hn;var Zo=Yr.default=Hn,xr={},fr={},Z={},oi={},dr={},ms;function Qo(){if(ms)return dr;ms=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return dr.delay=t,dr}var Kt={},ci={},Bt={},bs;function ec(){return bs||(bs=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.ONE_THOUSAND=Bt.ONE_HUNDRED=void 0,Bt.ONE_HUNDRED=100,Bt.ONE_THOUSAND=1e3),Bt}var hi={},vs;function tc(){return vs||(vs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(hi)),hi}var Es;function qn(){return Es||(Es=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(ec(),t),e.__exportStar(tc(),t)}(ci)),ci}var Ss;function rc(){if(Ss)return Kt;Ss=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.fromMiliseconds=Kt.toMiliseconds=void 0;const t=qn();function e(i){return i*t.ONE_THOUSAND}Kt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Kt.fromMiliseconds=r,Kt}var xs;function ic(){return xs||(xs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(Qo(),t),e.__exportStar(rc(),t)}(oi)),oi}var rr={},Is;function sc(){if(Is)return rr;Is=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return rr.Watch=t,rr.default=t,rr}var ui={},gr={},Os;function nc(){if(Os)return gr;Os=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.IWatch=void 0;class t{}return gr.IWatch=t,gr}var Ns;function ac(){return Ns||(Ns=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),mt.__exportStar(nc(),t)}(ui)),ui}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(ic(),t),e.__exportStar(sc(),t),e.__exportStar(ac(),t),e.__exportStar(qn(),t)})(Z);var li={},pr={};class Yt{}const oc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Yt},Symbol.toStringTag,{value:"Module"})),cc=Oo(oc);var Ts;function hc(){if(Ts)return pr;Ts=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.IHeartBeat=void 0;const t=cc;class e extends t.IEvents{constructor(i){super()}}return pr.IHeartBeat=e,pr}var As;function Kn(){return As||(As=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),mt.__exportStar(hc(),t)}(li)),li}var fi={},Vt={},Ps;function uc(){if(Ps)return Vt;Ps=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.HEARTBEAT_EVENTS=Vt.HEARTBEAT_INTERVAL=void 0;const t=Z;return Vt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Vt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Vt}var Rs;function Bn(){return Rs||(Rs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),mt.__exportStar(uc(),t)}(fi)),fi}var Us;function lc(){if(Us)return fr;Us=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.HeartBeat=void 0;const t=mt,e=yt,r=Z,i=Kn(),s=Bn();class o extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||s.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const h=new o(c);return yield h.init(),h})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,h){this.events.on(c,h)}once(c,h){this.events.once(c,h)}off(c,h){this.events.off(c,h)}removeListener(c,h){this.events.removeListener(c,h)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return fr.HeartBeat=o,fr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=mt;e.__exportStar(lc(),t),e.__exportStar(Kn(),t),e.__exportStar(Bn(),t)})(xr);var xe={},Gt={},Ls;function Vn(){return Ls||(Ls=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.PINO_CUSTOM_CONTEXT_KEY=Gt.PINO_LOGGER_DEFAULTS=void 0,Gt.PINO_LOGGER_DEFAULTS={level:"info"},Gt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Gt}var rt={},Fs;function fc(){if(Fs)return rt;Fs=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.generateChildLogger=rt.formatChildLoggerContext=rt.getLoggerContext=rt.setBrowserLoggerContext=rt.getBrowserLoggerContext=rt.getDefaultLoggerOptions=void 0;const t=Vn();function e(c){return Object.assign(Object.assign({},c),{level:(c==null?void 0:c.level)||t.PINO_LOGGER_DEFAULTS.level})}rt.getDefaultLoggerOptions=e;function r(c,h=t.PINO_CUSTOM_CONTEXT_KEY){return c[h]||""}rt.getBrowserLoggerContext=r;function i(c,h,m=t.PINO_CUSTOM_CONTEXT_KEY){return c[m]=h,c}rt.setBrowserLoggerContext=i;function s(c,h=t.PINO_CUSTOM_CONTEXT_KEY){let m="";return typeof c.bindings>"u"?m=r(c,h):m=c.bindings().context||"",m}rt.getLoggerContext=s;function o(c,h,m=t.PINO_CUSTOM_CONTEXT_KEY){const w=s(c,m);return w.trim()?`${w}/${h}`:h}rt.formatChildLoggerContext=o;function u(c,h,m=t.PINO_CUSTOM_CONTEXT_KEY){const w=o(c,h,m),E=c.child({context:w});return i(E,w,m)}return rt.generateChildLogger=u,rt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=mt,r=e.__importDefault(Er);Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(Vn(),t),e.__exportStar(fc(),t)})(xe);class dc extends Yt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class gc extends Yt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}let pc=class{constructor(e,r){this.logger=e,this.core=r}},yc=class extends Yt{constructor(e,r){super(),this.relayer=e,this.logger=r}};class _c extends Yt{constructor(e){super()}}let wc=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}},mc=class extends Yt{constructor(e,r){super(),this.relayer=e,this.logger=r}},bc=class extends Yt{constructor(e,r){super(),this.core=e,this.logger=r}},vc=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Ec=class{constructor(e){this.client=e}};var ji={},sr={},Jr={},Xr={};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.BrowserRandomSource=void 0;const Cs=65536;class Sc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Cs)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Cs)));return r}}Xr.BrowserRandomSource=Sc;function xc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Zr={},ft={};Object.defineProperty(ft,"__esModule",{value:!0});function Ic(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ft.wipe=Ic;Object.defineProperty(Zr,"__esModule",{value:!0});Zr.NodeRandomSource=void 0;const Oc=ft;class Nc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof xc<"u"){const e=No;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=r[s];return(0,Oc.wipe)(r),i}}Zr.NodeRandomSource=Nc;Object.defineProperty(Jr,"__esModule",{value:!0});Jr.SystemRandomSource=void 0;const Tc=Xr,Ac=Zr;class Pc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Tc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Ac.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Jr.SystemRandomSource=Pc;var re={},Gn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,h){var m=c>>>16&65535,w=c&65535,E=h>>>16&65535,P=h&65535;return w*P+(m*P+w*E<<16>>>0)|0}t.mul=Math.imul||e;function r(c,h){return c+h|0}t.add=r;function i(c,h){return c-h|0}t.sub=i;function s(c,h){return c<<h|c>>>32-h}t.rotl=s;function o(c,h){return c<<32-h|c>>>h}t.rotr=o;function u(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||u,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})(Gn);Object.defineProperty(re,"__esModule",{value:!0});var Wn=Gn;function Rc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}re.readInt16BE=Rc;function Uc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}re.readUint16BE=Uc;function Lc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}re.readInt16LE=Lc;function Fc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}re.readUint16LE=Fc;function kn(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}re.writeUint16BE=kn;re.writeInt16BE=kn;function Yn(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}re.writeUint16LE=Yn;re.writeInt16LE=Yn;function bi(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}re.readInt32BE=bi;function vi(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}re.readUint32BE=vi;function Ei(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}re.readInt32LE=Ei;function Si(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}re.readUint32LE=Si;function qr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}re.writeUint32BE=qr;re.writeInt32BE=qr;function Kr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}re.writeUint32LE=Kr;re.writeInt32LE=Kr;function Cc(t,e){e===void 0&&(e=0);var r=bi(t,e),i=bi(t,e+4);return r*4294967296+i-(i>>31)*4294967296}re.readInt64BE=Cc;function Mc(t,e){e===void 0&&(e=0);var r=vi(t,e),i=vi(t,e+4);return r*4294967296+i}re.readUint64BE=Mc;function Dc(t,e){e===void 0&&(e=0);var r=Ei(t,e),i=Ei(t,e+4);return i*4294967296+r-(r>>31)*4294967296}re.readInt64LE=Dc;function $c(t,e){e===void 0&&(e=0);var r=Si(t,e),i=Si(t,e+4);return i*4294967296+r}re.readUint64LE=$c;function Jn(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),qr(t/4294967296>>>0,e,r),qr(t>>>0,e,r+4),e}re.writeUint64BE=Jn;re.writeInt64BE=Jn;function Xn(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Kr(t>>>0,e,r),Kr(t/4294967296>>>0,e,r+4),e}re.writeUint64LE=Xn;re.writeInt64LE=Xn;function jc(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,o=t/8+r-1;o>=r;o--)i+=e[o]*s,s*=256;return i}re.readUintBE=jc;function zc(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,o=r;o<r+t/8;o++)i+=e[o]*s,s*=256;return i}re.readUintLE=zc;function Hc(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Wn.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,o=t/8+i-1;o>=i;o--)r[o]=e/s&255,s*=256;return r}re.writeUintBE=Hc;function qc(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Wn.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,o=i;o<i+t/8;o++)r[o]=e/s&255,s*=256;return r}re.writeUintLE=qc;function Kc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}re.readFloat32BE=Kc;function Bc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}re.readFloat32LE=Bc;function Vc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}re.readFloat64BE=Vc;function Gc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}re.readFloat64LE=Gc;function Wc(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}re.writeFloat32BE=Wc;function kc(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}re.writeFloat32LE=kc;function Yc(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}re.writeFloat64BE=Yc;function Jc(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}re.writeFloat64LE=Jc;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Jr,r=re,i=ft;t.defaultRandomSource=new e.SystemRandomSource;function s(m,w=t.defaultRandomSource){return w.randomBytes(m)}t.randomBytes=s;function o(m=t.defaultRandomSource){const w=s(4,m),E=(0,r.readUint32LE)(w);return(0,i.wipe)(w),E}t.randomUint32=o;const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(m,w=u,E=t.defaultRandomSource){if(w.length<2)throw new Error("randomString charset is too short");if(w.length>256)throw new Error("randomString charset is too long");let P="";const v=w.length,N=256-256%v;for(;m>0;){const C=s(Math.ceil(m*256/N),E);for(let R=0;R<C.length&&m>0;R++){const $=C[R];$<N&&(P+=w.charAt($%v),m--)}(0,i.wipe)(C)}return P}t.randomString=c;function h(m,w=u,E=t.defaultRandomSource){const P=Math.ceil(m/(Math.log(w.length)/Math.LN2));return c(P,w,E)}t.randomStringForEntropy=h})(sr);var Zn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ft;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,m){if(m===void 0&&(m=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var w=0;if(this._bytesHashed+=m,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&m>0;)this._buffer[this._bufferLength++]=h[w++],m--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(m>=this.blockSize&&(w=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,w,m),m%=this.blockSize);m>0;)this._buffer[this._bufferLength++]=h[w++],m--;return this},c.prototype.finish=function(h){if(!this._finished){var m=this._bytesHashed,w=this._bufferLength,E=m/536870912|0,P=m<<3,v=m%128<112?128:256;this._buffer[w]=128;for(var N=w+1;N<v-8;N++)this._buffer[N]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(P,this._buffer,v-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var N=0;N<this.digestLength/8;N++)e.writeUint32BE(this._stateHi[N],h,N*8),e.writeUint32BE(this._stateLo[N],h,N*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.stateHi),r.wipe(h.stateLo),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(c,h,m,w,E,P,v){for(var N=m[0],C=m[1],R=m[2],$=m[3],l=m[4],_=m[5],f=m[6],g=m[7],y=w[0],n=w[1],d=w[2],U=w[3],j=w[4],Y=w[5],J=w[6],X=w[7],A,T,W,z,F,M,D,H;v>=128;){for(var ie=0;ie<16;ie++){var q=8*ie+P;c[ie]=e.readUint32BE(E,q),h[ie]=e.readUint32BE(E,q+4)}for(var ie=0;ie<80;ie++){var Q=N,k=C,oe=R,O=$,I=l,S=_,a=f,b=g,K=y,V=n,le=d,_e=U,de=j,be=Y,Fe=J,Pe=X;if(A=g,T=X,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=(l>>>14|j<<32-14)^(l>>>18|j<<32-18)^(j>>>41-32|l<<32-(41-32)),T=(j>>>14|l<<32-14)^(j>>>18|l<<32-18)^(l>>>41-32|j<<32-(41-32)),F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,A=l&_^~l&f,T=j&Y^~j&J,F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,A=s[ie*2],T=s[ie*2+1],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,A=c[ie%16],T=h[ie%16],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,W=D&65535|H<<16,z=F&65535|M<<16,A=W,T=z,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=(N>>>28|y<<32-28)^(y>>>34-32|N<<32-(34-32))^(y>>>39-32|N<<32-(39-32)),T=(y>>>28|N<<32-28)^(N>>>34-32|y<<32-(34-32))^(N>>>39-32|y<<32-(39-32)),F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,A=N&C^N&R^C&R,T=y&n^y&d^n&d,F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,b=D&65535|H<<16,Pe=F&65535|M<<16,A=O,T=_e,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=W,T=z,F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,O=D&65535|H<<16,_e=F&65535|M<<16,C=Q,R=k,$=oe,l=O,_=I,f=S,g=a,N=b,n=K,d=V,U=le,j=_e,Y=de,J=be,X=Fe,y=Pe,ie%16===15)for(var q=0;q<16;q++)A=c[q],T=h[q],F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=c[(q+9)%16],T=h[(q+9)%16],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,W=c[(q+1)%16],z=h[(q+1)%16],A=(W>>>1|z<<32-1)^(W>>>8|z<<32-8)^W>>>7,T=(z>>>1|W<<32-1)^(z>>>8|W<<32-8)^(z>>>7|W<<32-7),F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,W=c[(q+14)%16],z=h[(q+14)%16],A=(W>>>19|z<<32-19)^(z>>>61-32|W<<32-(61-32))^W>>>6,T=(z>>>19|W<<32-19)^(W>>>61-32|z<<32-(61-32))^(z>>>6|W<<32-6),F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,c[q]=D&65535|H<<16,h[q]=F&65535|M<<16}A=N,T=y,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=m[0],T=w[0],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,m[0]=N=D&65535|H<<16,w[0]=y=F&65535|M<<16,A=C,T=n,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=m[1],T=w[1],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,m[1]=C=D&65535|H<<16,w[1]=n=F&65535|M<<16,A=R,T=d,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=m[2],T=w[2],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,m[2]=R=D&65535|H<<16,w[2]=d=F&65535|M<<16,A=$,T=U,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=m[3],T=w[3],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,m[3]=$=D&65535|H<<16,w[3]=U=F&65535|M<<16,A=l,T=j,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=m[4],T=w[4],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,m[4]=l=D&65535|H<<16,w[4]=j=F&65535|M<<16,A=_,T=Y,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=m[5],T=w[5],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,m[5]=_=D&65535|H<<16,w[5]=Y=F&65535|M<<16,A=f,T=J,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=m[6],T=w[6],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,m[6]=f=D&65535|H<<16,w[6]=J=F&65535|M<<16,A=g,T=X,F=T&65535,M=T>>>16,D=A&65535,H=A>>>16,A=m[7],T=w[7],F+=T&65535,M+=T>>>16,D+=A&65535,H+=A>>>16,M+=F>>>16,D+=M>>>16,H+=D>>>16,m[7]=g=D&65535|H<<16,w[7]=X=F&65535|M<<16,P+=128,v-=128}return P}function u(c){var h=new i;h.update(c);var m=h.digest();return h.clean(),m}t.hash=u})(Zn);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=sr,r=Zn,i=ft;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function s(O){const I=new Float64Array(16);if(O)for(let S=0;S<O.length;S++)I[S]=O[S];return I}const o=new Uint8Array(32);o[0]=9;const u=s(),c=s([1]),h=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),m=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),w=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),E=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),P=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(O,I){for(let S=0;S<16;S++)O[S]=I[S]|0}function N(O){let I=1;for(let S=0;S<16;S++){let a=O[S]+I+65535;I=Math.floor(a/65536),O[S]=a-I*65536}O[0]+=I-1+37*(I-1)}function C(O,I,S){const a=~(S-1);for(let b=0;b<16;b++){const K=a&(O[b]^I[b]);O[b]^=K,I[b]^=K}}function R(O,I){const S=s(),a=s();for(let b=0;b<16;b++)a[b]=I[b];N(a),N(a),N(a);for(let b=0;b<2;b++){S[0]=a[0]-65517;for(let V=1;V<15;V++)S[V]=a[V]-65535-(S[V-1]>>16&1),S[V-1]&=65535;S[15]=a[15]-32767-(S[14]>>16&1);const K=S[15]>>16&1;S[14]&=65535,C(a,S,1-K)}for(let b=0;b<16;b++)O[2*b]=a[b]&255,O[2*b+1]=a[b]>>8}function $(O,I){let S=0;for(let a=0;a<32;a++)S|=O[a]^I[a];return(1&S-1>>>8)-1}function l(O,I){const S=new Uint8Array(32),a=new Uint8Array(32);return R(S,O),R(a,I),$(S,a)}function _(O){const I=new Uint8Array(32);return R(I,O),I[0]&1}function f(O,I){for(let S=0;S<16;S++)O[S]=I[2*S]+(I[2*S+1]<<8);O[15]&=32767}function g(O,I,S){for(let a=0;a<16;a++)O[a]=I[a]+S[a]}function y(O,I,S){for(let a=0;a<16;a++)O[a]=I[a]-S[a]}function n(O,I,S){let a,b,K=0,V=0,le=0,_e=0,de=0,be=0,Fe=0,Pe=0,ye=0,ge=0,fe=0,he=0,ce=0,ae=0,ne=0,ee=0,ue=0,pe=0,te=0,we=0,me=0,Ee=0,Se=0,ve=0,_t=0,bt=0,Rt=0,ht=0,jt=0,or=0,Ar=0,Me=S[0],Re=S[1],De=S[2],$e=S[3],je=S[4],Ue=S[5],qe=S[6],Ke=S[7],Be=S[8],Ve=S[9],Ge=S[10],He=S[11],ze=S[12],Te=S[13],We=S[14],ke=S[15];a=I[0],K+=a*Me,V+=a*Re,le+=a*De,_e+=a*$e,de+=a*je,be+=a*Ue,Fe+=a*qe,Pe+=a*Ke,ye+=a*Be,ge+=a*Ve,fe+=a*Ge,he+=a*He,ce+=a*ze,ae+=a*Te,ne+=a*We,ee+=a*ke,a=I[1],V+=a*Me,le+=a*Re,_e+=a*De,de+=a*$e,be+=a*je,Fe+=a*Ue,Pe+=a*qe,ye+=a*Ke,ge+=a*Be,fe+=a*Ve,he+=a*Ge,ce+=a*He,ae+=a*ze,ne+=a*Te,ee+=a*We,ue+=a*ke,a=I[2],le+=a*Me,_e+=a*Re,de+=a*De,be+=a*$e,Fe+=a*je,Pe+=a*Ue,ye+=a*qe,ge+=a*Ke,fe+=a*Be,he+=a*Ve,ce+=a*Ge,ae+=a*He,ne+=a*ze,ee+=a*Te,ue+=a*We,pe+=a*ke,a=I[3],_e+=a*Me,de+=a*Re,be+=a*De,Fe+=a*$e,Pe+=a*je,ye+=a*Ue,ge+=a*qe,fe+=a*Ke,he+=a*Be,ce+=a*Ve,ae+=a*Ge,ne+=a*He,ee+=a*ze,ue+=a*Te,pe+=a*We,te+=a*ke,a=I[4],de+=a*Me,be+=a*Re,Fe+=a*De,Pe+=a*$e,ye+=a*je,ge+=a*Ue,fe+=a*qe,he+=a*Ke,ce+=a*Be,ae+=a*Ve,ne+=a*Ge,ee+=a*He,ue+=a*ze,pe+=a*Te,te+=a*We,we+=a*ke,a=I[5],be+=a*Me,Fe+=a*Re,Pe+=a*De,ye+=a*$e,ge+=a*je,fe+=a*Ue,he+=a*qe,ce+=a*Ke,ae+=a*Be,ne+=a*Ve,ee+=a*Ge,ue+=a*He,pe+=a*ze,te+=a*Te,we+=a*We,me+=a*ke,a=I[6],Fe+=a*Me,Pe+=a*Re,ye+=a*De,ge+=a*$e,fe+=a*je,he+=a*Ue,ce+=a*qe,ae+=a*Ke,ne+=a*Be,ee+=a*Ve,ue+=a*Ge,pe+=a*He,te+=a*ze,we+=a*Te,me+=a*We,Ee+=a*ke,a=I[7],Pe+=a*Me,ye+=a*Re,ge+=a*De,fe+=a*$e,he+=a*je,ce+=a*Ue,ae+=a*qe,ne+=a*Ke,ee+=a*Be,ue+=a*Ve,pe+=a*Ge,te+=a*He,we+=a*ze,me+=a*Te,Ee+=a*We,Se+=a*ke,a=I[8],ye+=a*Me,ge+=a*Re,fe+=a*De,he+=a*$e,ce+=a*je,ae+=a*Ue,ne+=a*qe,ee+=a*Ke,ue+=a*Be,pe+=a*Ve,te+=a*Ge,we+=a*He,me+=a*ze,Ee+=a*Te,Se+=a*We,ve+=a*ke,a=I[9],ge+=a*Me,fe+=a*Re,he+=a*De,ce+=a*$e,ae+=a*je,ne+=a*Ue,ee+=a*qe,ue+=a*Ke,pe+=a*Be,te+=a*Ve,we+=a*Ge,me+=a*He,Ee+=a*ze,Se+=a*Te,ve+=a*We,_t+=a*ke,a=I[10],fe+=a*Me,he+=a*Re,ce+=a*De,ae+=a*$e,ne+=a*je,ee+=a*Ue,ue+=a*qe,pe+=a*Ke,te+=a*Be,we+=a*Ve,me+=a*Ge,Ee+=a*He,Se+=a*ze,ve+=a*Te,_t+=a*We,bt+=a*ke,a=I[11],he+=a*Me,ce+=a*Re,ae+=a*De,ne+=a*$e,ee+=a*je,ue+=a*Ue,pe+=a*qe,te+=a*Ke,we+=a*Be,me+=a*Ve,Ee+=a*Ge,Se+=a*He,ve+=a*ze,_t+=a*Te,bt+=a*We,Rt+=a*ke,a=I[12],ce+=a*Me,ae+=a*Re,ne+=a*De,ee+=a*$e,ue+=a*je,pe+=a*Ue,te+=a*qe,we+=a*Ke,me+=a*Be,Ee+=a*Ve,Se+=a*Ge,ve+=a*He,_t+=a*ze,bt+=a*Te,Rt+=a*We,ht+=a*ke,a=I[13],ae+=a*Me,ne+=a*Re,ee+=a*De,ue+=a*$e,pe+=a*je,te+=a*Ue,we+=a*qe,me+=a*Ke,Ee+=a*Be,Se+=a*Ve,ve+=a*Ge,_t+=a*He,bt+=a*ze,Rt+=a*Te,ht+=a*We,jt+=a*ke,a=I[14],ne+=a*Me,ee+=a*Re,ue+=a*De,pe+=a*$e,te+=a*je,we+=a*Ue,me+=a*qe,Ee+=a*Ke,Se+=a*Be,ve+=a*Ve,_t+=a*Ge,bt+=a*He,Rt+=a*ze,ht+=a*Te,jt+=a*We,or+=a*ke,a=I[15],ee+=a*Me,ue+=a*Re,pe+=a*De,te+=a*$e,we+=a*je,me+=a*Ue,Ee+=a*qe,Se+=a*Ke,ve+=a*Be,_t+=a*Ve,bt+=a*Ge,Rt+=a*He,ht+=a*ze,jt+=a*Te,or+=a*We,Ar+=a*ke,K+=38*ue,V+=38*pe,le+=38*te,_e+=38*we,de+=38*me,be+=38*Ee,Fe+=38*Se,Pe+=38*ve,ye+=38*_t,ge+=38*bt,fe+=38*Rt,he+=38*ht,ce+=38*jt,ae+=38*or,ne+=38*Ar,b=1,a=K+b+65535,b=Math.floor(a/65536),K=a-b*65536,a=V+b+65535,b=Math.floor(a/65536),V=a-b*65536,a=le+b+65535,b=Math.floor(a/65536),le=a-b*65536,a=_e+b+65535,b=Math.floor(a/65536),_e=a-b*65536,a=de+b+65535,b=Math.floor(a/65536),de=a-b*65536,a=be+b+65535,b=Math.floor(a/65536),be=a-b*65536,a=Fe+b+65535,b=Math.floor(a/65536),Fe=a-b*65536,a=Pe+b+65535,b=Math.floor(a/65536),Pe=a-b*65536,a=ye+b+65535,b=Math.floor(a/65536),ye=a-b*65536,a=ge+b+65535,b=Math.floor(a/65536),ge=a-b*65536,a=fe+b+65535,b=Math.floor(a/65536),fe=a-b*65536,a=he+b+65535,b=Math.floor(a/65536),he=a-b*65536,a=ce+b+65535,b=Math.floor(a/65536),ce=a-b*65536,a=ae+b+65535,b=Math.floor(a/65536),ae=a-b*65536,a=ne+b+65535,b=Math.floor(a/65536),ne=a-b*65536,a=ee+b+65535,b=Math.floor(a/65536),ee=a-b*65536,K+=b-1+37*(b-1),b=1,a=K+b+65535,b=Math.floor(a/65536),K=a-b*65536,a=V+b+65535,b=Math.floor(a/65536),V=a-b*65536,a=le+b+65535,b=Math.floor(a/65536),le=a-b*65536,a=_e+b+65535,b=Math.floor(a/65536),_e=a-b*65536,a=de+b+65535,b=Math.floor(a/65536),de=a-b*65536,a=be+b+65535,b=Math.floor(a/65536),be=a-b*65536,a=Fe+b+65535,b=Math.floor(a/65536),Fe=a-b*65536,a=Pe+b+65535,b=Math.floor(a/65536),Pe=a-b*65536,a=ye+b+65535,b=Math.floor(a/65536),ye=a-b*65536,a=ge+b+65535,b=Math.floor(a/65536),ge=a-b*65536,a=fe+b+65535,b=Math.floor(a/65536),fe=a-b*65536,a=he+b+65535,b=Math.floor(a/65536),he=a-b*65536,a=ce+b+65535,b=Math.floor(a/65536),ce=a-b*65536,a=ae+b+65535,b=Math.floor(a/65536),ae=a-b*65536,a=ne+b+65535,b=Math.floor(a/65536),ne=a-b*65536,a=ee+b+65535,b=Math.floor(a/65536),ee=a-b*65536,K+=b-1+37*(b-1),O[0]=K,O[1]=V,O[2]=le,O[3]=_e,O[4]=de,O[5]=be,O[6]=Fe,O[7]=Pe,O[8]=ye,O[9]=ge,O[10]=fe,O[11]=he,O[12]=ce,O[13]=ae,O[14]=ne,O[15]=ee}function d(O,I){n(O,I,I)}function U(O,I){const S=s();let a;for(a=0;a<16;a++)S[a]=I[a];for(a=253;a>=0;a--)d(S,S),a!==2&&a!==4&&n(S,S,I);for(a=0;a<16;a++)O[a]=S[a]}function j(O,I){const S=s();let a;for(a=0;a<16;a++)S[a]=I[a];for(a=250;a>=0;a--)d(S,S),a!==1&&n(S,S,I);for(a=0;a<16;a++)O[a]=S[a]}function Y(O,I){const S=s(),a=s(),b=s(),K=s(),V=s(),le=s(),_e=s(),de=s(),be=s();y(S,O[1],O[0]),y(be,I[1],I[0]),n(S,S,be),g(a,O[0],O[1]),g(be,I[0],I[1]),n(a,a,be),n(b,O[3],I[3]),n(b,b,m),n(K,O[2],I[2]),g(K,K,K),y(V,a,S),y(le,K,b),g(_e,K,b),g(de,a,S),n(O[0],V,le),n(O[1],de,_e),n(O[2],_e,le),n(O[3],V,de)}function J(O,I,S){for(let a=0;a<4;a++)C(O[a],I[a],S)}function X(O,I){const S=s(),a=s(),b=s();U(b,I[2]),n(S,I[0],b),n(a,I[1],b),R(O,a),O[31]^=_(S)<<7}function A(O,I,S){v(O[0],u),v(O[1],c),v(O[2],c),v(O[3],u);for(let a=255;a>=0;--a){const b=S[a/8|0]>>(a&7)&1;J(O,I,b),Y(I,O),Y(O,O),J(O,I,b)}}function T(O,I){const S=[s(),s(),s(),s()];v(S[0],w),v(S[1],E),v(S[2],c),n(S[3],w,E),A(O,S,I)}function W(O){if(O.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const I=(0,r.hash)(O);I[0]&=248,I[31]&=127,I[31]|=64;const S=new Uint8Array(32),a=[s(),s(),s(),s()];T(a,I),X(S,a);const b=new Uint8Array(64);return b.set(O),b.set(S,32),{publicKey:S,secretKey:b}}t.generateKeyPairFromSeed=W;function z(O){const I=(0,e.randomBytes)(32,O),S=W(I);return(0,i.wipe)(I),S}t.generateKeyPair=z;function F(O){if(O.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}t.extractPublicKeyFromSecretKey=F;const M=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function D(O,I){let S,a,b,K;for(a=63;a>=32;--a){for(S=0,b=a-32,K=a-12;b<K;++b)I[b]+=S-16*I[a]*M[b-(a-32)],S=Math.floor((I[b]+128)/256),I[b]-=S*256;I[b]+=S,I[a]=0}for(S=0,b=0;b<32;b++)I[b]+=S-(I[31]>>4)*M[b],S=I[b]>>8,I[b]&=255;for(b=0;b<32;b++)I[b]-=S*M[b];for(a=0;a<32;a++)I[a+1]+=I[a]>>8,O[a]=I[a]&255}function H(O){const I=new Float64Array(64);for(let S=0;S<64;S++)I[S]=O[S];for(let S=0;S<64;S++)O[S]=0;D(O,I)}function ie(O,I){const S=new Float64Array(64),a=[s(),s(),s(),s()],b=(0,r.hash)(O.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const K=new Uint8Array(64);K.set(b.subarray(32),32);const V=new r.SHA512;V.update(K.subarray(32)),V.update(I);const le=V.digest();V.clean(),H(le),T(a,le),X(K,a),V.reset(),V.update(K.subarray(0,32)),V.update(O.subarray(32)),V.update(I);const _e=V.digest();H(_e);for(let de=0;de<32;de++)S[de]=le[de];for(let de=0;de<32;de++)for(let be=0;be<32;be++)S[de+be]+=_e[de]*b[be];return D(K.subarray(32),S),K}t.sign=ie;function q(O,I){const S=s(),a=s(),b=s(),K=s(),V=s(),le=s(),_e=s();return v(O[2],c),f(O[1],I),d(b,O[1]),n(K,b,h),y(b,b,O[2]),g(K,O[2],K),d(V,K),d(le,V),n(_e,le,V),n(S,_e,b),n(S,S,K),j(S,S),n(S,S,b),n(S,S,K),n(S,S,K),n(O[0],S,K),d(a,O[0]),n(a,a,K),l(a,b)&&n(O[0],O[0],P),d(a,O[0]),n(a,a,K),l(a,b)?-1:(_(O[0])===I[31]>>7&&y(O[0],u,O[0]),n(O[3],O[0],O[1]),0)}function Q(O,I,S){const a=new Uint8Array(32),b=[s(),s(),s(),s()],K=[s(),s(),s(),s()];if(S.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(q(K,O))return!1;const V=new r.SHA512;V.update(S.subarray(0,32)),V.update(O),V.update(I);const le=V.digest();return H(le),A(b,K,le),T(K,S.subarray(32)),Y(b,K),X(a,b),!$(S,a)}t.verify=Q;function k(O){let I=[s(),s(),s(),s()];if(q(I,O))throw new Error("Ed25519: invalid public key");let S=s(),a=s(),b=I[1];g(S,c,b),y(a,c,b),U(a,a),n(S,S,a);let K=new Uint8Array(32);return R(K,S),K}t.convertPublicKeyToX25519=k;function oe(O){const I=(0,r.hash)(O.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const S=new Uint8Array(I.subarray(0,32));return(0,i.wipe)(I),S}t.convertSecretKeyToX25519=oe})(ji);const Xc="EdDSA",Zc="JWT",Qn=".",ea="base64url",Qc="utf8",eh="utf8",th=":",rh="did",ih="key",Ms="base58btc",sh="z",nh="K36",ah=32;function Br(t){return ct(at(Li(t),Qc),ea)}function ta(t){const e=at(nh,Ms),r=sh+ct(wi([e,t]),Ms);return[rh,ih,r].join(th)}function oh(t){return ct(t,ea)}function ch(t){return at([Br(t.header),Br(t.payload)].join(Qn),eh)}function hh(t){return[Br(t.header),Br(t.payload),oh(t.signature)].join(Qn)}function Ds(t=sr.randomBytes(ah)){return ji.generateKeyPairFromSeed(t)}async function uh(t,e,r,i,s=Z.fromMiliseconds(Date.now())){const o={alg:Xc,typ:Zc},u=ta(i.publicKey),c=s+r,h={iss:u,sub:t,aud:e,iat:s,exp:c},m=ch({header:o,payload:h}),w=ji.sign(i.secretKey,m);return hh({header:o,payload:h,signature:w})}var zi={},Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});var tt=re,xi=ft,lh=20;function fh(t,e,r){for(var i=1634760805,s=857760878,o=2036477234,u=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],h=r[7]<<24|r[6]<<16|r[5]<<8|r[4],m=r[11]<<24|r[10]<<16|r[9]<<8|r[8],w=r[15]<<24|r[14]<<16|r[13]<<8|r[12],E=r[19]<<24|r[18]<<16|r[17]<<8|r[16],P=r[23]<<24|r[22]<<16|r[21]<<8|r[20],v=r[27]<<24|r[26]<<16|r[25]<<8|r[24],N=r[31]<<24|r[30]<<16|r[29]<<8|r[28],C=e[3]<<24|e[2]<<16|e[1]<<8|e[0],R=e[7]<<24|e[6]<<16|e[5]<<8|e[4],$=e[11]<<24|e[10]<<16|e[9]<<8|e[8],l=e[15]<<24|e[14]<<16|e[13]<<8|e[12],_=i,f=s,g=o,y=u,n=c,d=h,U=m,j=w,Y=E,J=P,X=v,A=N,T=C,W=R,z=$,F=l,M=0;M<lh;M+=2)_=_+n|0,T^=_,T=T>>>32-16|T<<16,Y=Y+T|0,n^=Y,n=n>>>32-12|n<<12,f=f+d|0,W^=f,W=W>>>32-16|W<<16,J=J+W|0,d^=J,d=d>>>32-12|d<<12,g=g+U|0,z^=g,z=z>>>32-16|z<<16,X=X+z|0,U^=X,U=U>>>32-12|U<<12,y=y+j|0,F^=y,F=F>>>32-16|F<<16,A=A+F|0,j^=A,j=j>>>32-12|j<<12,g=g+U|0,z^=g,z=z>>>32-8|z<<8,X=X+z|0,U^=X,U=U>>>32-7|U<<7,y=y+j|0,F^=y,F=F>>>32-8|F<<8,A=A+F|0,j^=A,j=j>>>32-7|j<<7,f=f+d|0,W^=f,W=W>>>32-8|W<<8,J=J+W|0,d^=J,d=d>>>32-7|d<<7,_=_+n|0,T^=_,T=T>>>32-8|T<<8,Y=Y+T|0,n^=Y,n=n>>>32-7|n<<7,_=_+d|0,F^=_,F=F>>>32-16|F<<16,X=X+F|0,d^=X,d=d>>>32-12|d<<12,f=f+U|0,T^=f,T=T>>>32-16|T<<16,A=A+T|0,U^=A,U=U>>>32-12|U<<12,g=g+j|0,W^=g,W=W>>>32-16|W<<16,Y=Y+W|0,j^=Y,j=j>>>32-12|j<<12,y=y+n|0,z^=y,z=z>>>32-16|z<<16,J=J+z|0,n^=J,n=n>>>32-12|n<<12,g=g+j|0,W^=g,W=W>>>32-8|W<<8,Y=Y+W|0,j^=Y,j=j>>>32-7|j<<7,y=y+n|0,z^=y,z=z>>>32-8|z<<8,J=J+z|0,n^=J,n=n>>>32-7|n<<7,f=f+U|0,T^=f,T=T>>>32-8|T<<8,A=A+T|0,U^=A,U=U>>>32-7|U<<7,_=_+d|0,F^=_,F=F>>>32-8|F<<8,X=X+F|0,d^=X,d=d>>>32-7|d<<7;tt.writeUint32LE(_+i|0,t,0),tt.writeUint32LE(f+s|0,t,4),tt.writeUint32LE(g+o|0,t,8),tt.writeUint32LE(y+u|0,t,12),tt.writeUint32LE(n+c|0,t,16),tt.writeUint32LE(d+h|0,t,20),tt.writeUint32LE(U+m|0,t,24),tt.writeUint32LE(j+w|0,t,28),tt.writeUint32LE(Y+E|0,t,32),tt.writeUint32LE(J+P|0,t,36),tt.writeUint32LE(X+v|0,t,40),tt.writeUint32LE(A+N|0,t,44),tt.writeUint32LE(T+C|0,t,48),tt.writeUint32LE(W+R|0,t,52),tt.writeUint32LE(z+$|0,t,56),tt.writeUint32LE(F+l|0,t,60)}function ra(t,e,r,i,s){if(s===void 0&&(s=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var o,u;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=new Uint8Array(16),u=o.length-e.length,o.set(e,u)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");o=e,u=s}for(var c=new Uint8Array(64),h=0;h<r.length;h+=64){fh(c,o,t);for(var m=h;m<h+64&&m<r.length;m++)i[m]=r[m]^c[m-h];gh(o,0,u)}return xi.wipe(c),s===0&&xi.wipe(o),i}Qr.streamXOR=ra;function dh(t,e,r,i){return i===void 0&&(i=0),xi.wipe(r),ra(t,e,r,r,i)}Qr.stream=dh;function gh(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var ia={},$t={};Object.defineProperty($t,"__esModule",{value:!0});function ph(t,e,r){return~(t-1)&e|t-1&r}$t.select=ph;function yh(t,e){return(t|0)-(e|0)-1>>>31&1}$t.lessOrEqual=yh;function sa(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}$t.compare=sa;function _h(t,e){return t.length===0||e.length===0?!1:sa(t,e)!==0}$t.equal=_h;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=$t,r=ft;t.DIGEST_LENGTH=16;var i=function(){function u(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var m=c[2]|c[3]<<8;this._r[1]=(h>>>13|m<<3)&8191;var w=c[4]|c[5]<<8;this._r[2]=(m>>>10|w<<6)&7939;var E=c[6]|c[7]<<8;this._r[3]=(w>>>7|E<<9)&8191;var P=c[8]|c[9]<<8;this._r[4]=(E>>>4|P<<12)&255,this._r[5]=P>>>1&8190;var v=c[10]|c[11]<<8;this._r[6]=(P>>>14|v<<2)&8191;var N=c[12]|c[13]<<8;this._r[7]=(v>>>11|N<<5)&8065;var C=c[14]|c[15]<<8;this._r[8]=(N>>>8|C<<8)&8191,this._r[9]=C>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return u.prototype._blocks=function(c,h,m){for(var w=this._fin?0:2048,E=this._h[0],P=this._h[1],v=this._h[2],N=this._h[3],C=this._h[4],R=this._h[5],$=this._h[6],l=this._h[7],_=this._h[8],f=this._h[9],g=this._r[0],y=this._r[1],n=this._r[2],d=this._r[3],U=this._r[4],j=this._r[5],Y=this._r[6],J=this._r[7],X=this._r[8],A=this._r[9];m>=16;){var T=c[h+0]|c[h+1]<<8;E+=T&8191;var W=c[h+2]|c[h+3]<<8;P+=(T>>>13|W<<3)&8191;var z=c[h+4]|c[h+5]<<8;v+=(W>>>10|z<<6)&8191;var F=c[h+6]|c[h+7]<<8;N+=(z>>>7|F<<9)&8191;var M=c[h+8]|c[h+9]<<8;C+=(F>>>4|M<<12)&8191,R+=M>>>1&8191;var D=c[h+10]|c[h+11]<<8;$+=(M>>>14|D<<2)&8191;var H=c[h+12]|c[h+13]<<8;l+=(D>>>11|H<<5)&8191;var ie=c[h+14]|c[h+15]<<8;_+=(H>>>8|ie<<8)&8191,f+=ie>>>5|w;var q=0,Q=q;Q+=E*g,Q+=P*(5*A),Q+=v*(5*X),Q+=N*(5*J),Q+=C*(5*Y),q=Q>>>13,Q&=8191,Q+=R*(5*j),Q+=$*(5*U),Q+=l*(5*d),Q+=_*(5*n),Q+=f*(5*y),q+=Q>>>13,Q&=8191;var k=q;k+=E*y,k+=P*g,k+=v*(5*A),k+=N*(5*X),k+=C*(5*J),q=k>>>13,k&=8191,k+=R*(5*Y),k+=$*(5*j),k+=l*(5*U),k+=_*(5*d),k+=f*(5*n),q+=k>>>13,k&=8191;var oe=q;oe+=E*n,oe+=P*y,oe+=v*g,oe+=N*(5*A),oe+=C*(5*X),q=oe>>>13,oe&=8191,oe+=R*(5*J),oe+=$*(5*Y),oe+=l*(5*j),oe+=_*(5*U),oe+=f*(5*d),q+=oe>>>13,oe&=8191;var O=q;O+=E*d,O+=P*n,O+=v*y,O+=N*g,O+=C*(5*A),q=O>>>13,O&=8191,O+=R*(5*X),O+=$*(5*J),O+=l*(5*Y),O+=_*(5*j),O+=f*(5*U),q+=O>>>13,O&=8191;var I=q;I+=E*U,I+=P*d,I+=v*n,I+=N*y,I+=C*g,q=I>>>13,I&=8191,I+=R*(5*A),I+=$*(5*X),I+=l*(5*J),I+=_*(5*Y),I+=f*(5*j),q+=I>>>13,I&=8191;var S=q;S+=E*j,S+=P*U,S+=v*d,S+=N*n,S+=C*y,q=S>>>13,S&=8191,S+=R*g,S+=$*(5*A),S+=l*(5*X),S+=_*(5*J),S+=f*(5*Y),q+=S>>>13,S&=8191;var a=q;a+=E*Y,a+=P*j,a+=v*U,a+=N*d,a+=C*n,q=a>>>13,a&=8191,a+=R*y,a+=$*g,a+=l*(5*A),a+=_*(5*X),a+=f*(5*J),q+=a>>>13,a&=8191;var b=q;b+=E*J,b+=P*Y,b+=v*j,b+=N*U,b+=C*d,q=b>>>13,b&=8191,b+=R*n,b+=$*y,b+=l*g,b+=_*(5*A),b+=f*(5*X),q+=b>>>13,b&=8191;var K=q;K+=E*X,K+=P*J,K+=v*Y,K+=N*j,K+=C*U,q=K>>>13,K&=8191,K+=R*d,K+=$*n,K+=l*y,K+=_*g,K+=f*(5*A),q+=K>>>13,K&=8191;var V=q;V+=E*A,V+=P*X,V+=v*J,V+=N*Y,V+=C*j,q=V>>>13,V&=8191,V+=R*U,V+=$*d,V+=l*n,V+=_*y,V+=f*g,q+=V>>>13,V&=8191,q=(q<<2)+q|0,q=q+Q|0,Q=q&8191,q=q>>>13,k+=q,E=Q,P=k,v=oe,N=O,C=I,R=S,$=a,l=b,_=K,f=V,h+=16,m-=16}this._h[0]=E,this._h[1]=P,this._h[2]=v,this._h[3]=N,this._h[4]=C,this._h[5]=R,this._h[6]=$,this._h[7]=l,this._h[8]=_,this._h[9]=f},u.prototype.finish=function(c,h){h===void 0&&(h=0);var m=new Uint16Array(10),w,E,P,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(w=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=w,w=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=w*5,w=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=w,w=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=w,m[0]=this._h[0]+5,w=m[0]>>>13,m[0]&=8191,v=1;v<10;v++)m[v]=this._h[v]+w,w=m[v]>>>13,m[v]&=8191;for(m[9]-=1<<13,E=(w^1)-1,v=0;v<10;v++)m[v]&=E;for(E=~E,v=0;v<10;v++)this._h[v]=this._h[v]&E|m[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,P=this._h[0]+this._pad[0],this._h[0]=P&65535,v=1;v<8;v++)P=(this._h[v]+this._pad[v]|0)+(P>>>16)|0,this._h[v]=P&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},u.prototype.update=function(c){var h=0,m=c.length,w;if(this._leftover){w=16-this._leftover,w>m&&(w=m);for(var E=0;E<w;E++)this._buffer[this._leftover+E]=c[h+E];if(m-=w,h+=w,this._leftover+=w,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(m>=16&&(w=m-m%16,this._blocks(c,h,w),h+=w,m-=w),m){for(var E=0;E<m;E++)this._buffer[this._leftover+E]=c[h+E];this._leftover+=m}return this},u.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},u.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},u}();t.Poly1305=i;function s(u,c){var h=new i(u);h.update(c);var m=h.digest();return h.clean(),m}t.oneTimeAuth=s;function o(u,c){return u.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(u,c)}t.equal=o})(ia);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Qr,r=ia,i=ft,s=re,o=$t;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var u=new Uint8Array(16),c=function(){function h(m){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,m.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(m)}return h.prototype.seal=function(m,w,E,P){if(m.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(m,v.length-m.length);var N=new Uint8Array(32);e.stream(this._key,v,N,4);var C=w.length+this.tagLength,R;if(P){if(P.length!==C)throw new Error("ChaCha20Poly1305: incorrect destination length");R=P}else R=new Uint8Array(C);return e.streamXOR(this._key,v,w,R,4),this._authenticate(R.subarray(R.length-this.tagLength,R.length),N,R.subarray(0,R.length-this.tagLength),E),i.wipe(v),R},h.prototype.open=function(m,w,E,P){if(m.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(w.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(m,v.length-m.length);var N=new Uint8Array(32);e.stream(this._key,v,N,4);var C=new Uint8Array(this.tagLength);if(this._authenticate(C,N,w.subarray(0,w.length-this.tagLength),E),!o.equal(C,w.subarray(w.length-this.tagLength,w.length)))return null;var R=w.length-this.tagLength,$;if(P){if(P.length!==R)throw new Error("ChaCha20Poly1305: incorrect destination length");$=P}else $=new Uint8Array(R);return e.streamXOR(this._key,v,w.subarray(0,w.length-this.tagLength),$,4),i.wipe(v),$},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(m,w,E,P){var v=new r.Poly1305(w);P&&(v.update(P),P.length%16>0&&v.update(u.subarray(P.length%16))),v.update(E),E.length%16>0&&v.update(u.subarray(E.length%16));var N=new Uint8Array(8);P&&s.writeUint64LE(P.length,N),v.update(N),s.writeUint64LE(E.length,N),v.update(N);for(var C=v.digest(),R=0;R<C.length;R++)m[R]=C[R];v.clean(),i.wipe(C),i.wipe(N)},h}();t.ChaCha20Poly1305=c})(zi);var na={},Ir={},Hi={};Object.defineProperty(Hi,"__esModule",{value:!0});function wh(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}Hi.isSerializableHash=wh;Object.defineProperty(Ir,"__esModule",{value:!0});var vt=Hi,mh=$t,bh=ft,aa=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),vt.isSerializableHash(this._inner)&&vt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),bh.wipe(i)}return t.prototype.reset=function(){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){vt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),vt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Ir.HMAC=aa;function vh(t,e,r){var i=new aa(t,e);i.update(r);var s=i.digest();return i.clean(),s}Ir.hmac=vh;Ir.equal=mh.equal;Object.defineProperty(na,"__esModule",{value:!0});var $s=Ir,js=ft,Eh=function(){function t(e,r,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var o=$s.hmac(this._hash,i,r);this._hmac=new $s.HMAC(e,o),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),js.wipe(this._buffer),js.wipe(this._counter),this._bufpos=0},t}(),Sh=na.HKDF=Eh,ei={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ft;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(h,m){if(m===void 0&&(m=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var w=0;if(this._bytesHashed+=m,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&m>0;)this._buffer[this._bufferLength++]=h[w++],m--;this._bufferLength===this.blockSize&&(o(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(m>=this.blockSize&&(w=o(this._temp,this._state,h,w,m),m%=this.blockSize);m>0;)this._buffer[this._bufferLength++]=h[w++],m--;return this},c.prototype.finish=function(h){if(!this._finished){var m=this._bytesHashed,w=this._bufferLength,E=m/536870912|0,P=m<<3,v=m%64<56?64:128;this._buffer[w]=128;for(var N=w+1;N<v-8;N++)this._buffer[N]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(P,this._buffer,v-4),o(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var N=0;N<this.digestLength/4;N++)e.writeUint32BE(this._state[N],h,N*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.state),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function o(c,h,m,w,E){for(;E>=64;){for(var P=h[0],v=h[1],N=h[2],C=h[3],R=h[4],$=h[5],l=h[6],_=h[7],f=0;f<16;f++){var g=w+f*4;c[f]=e.readUint32BE(m,g)}for(var f=16;f<64;f++){var y=c[f-2],n=(y>>>17|y<<32-17)^(y>>>19|y<<32-19)^y>>>10;y=c[f-15];var d=(y>>>7|y<<32-7)^(y>>>18|y<<32-18)^y>>>3;c[f]=(n+c[f-7]|0)+(d+c[f-16]|0)}for(var f=0;f<64;f++){var n=(((R>>>6|R<<26)^(R>>>11|R<<21)^(R>>>25|R<<7))+(R&$^~R&l)|0)+(_+(s[f]+c[f]|0)|0)|0,d=((P>>>2|P<<32-2)^(P>>>13|P<<32-13)^(P>>>22|P<<32-22))+(P&v^P&N^v&N)|0;_=l,l=$,$=R,R=C+n|0,C=N,N=v,v=P,P=n+d|0}h[0]+=P,h[1]+=v,h[2]+=N,h[3]+=C,h[4]+=R,h[5]+=$,h[6]+=l,h[7]+=_,w+=64,E-=64}return w}function u(c){var h=new i;h.update(c);var m=h.digest();return h.clean(),m}t.hash=u})(ei);var qi={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=sr,r=ft;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(f){const g=new Float64Array(16);if(f)for(let y=0;y<f.length;y++)g[y]=f[y];return g}const s=new Uint8Array(32);s[0]=9;const o=i([56129,1]);function u(f){let g=1;for(let y=0;y<16;y++){let n=f[y]+g+65535;g=Math.floor(n/65536),f[y]=n-g*65536}f[0]+=g-1+37*(g-1)}function c(f,g,y){const n=~(y-1);for(let d=0;d<16;d++){const U=n&(f[d]^g[d]);f[d]^=U,g[d]^=U}}function h(f,g){const y=i(),n=i();for(let d=0;d<16;d++)n[d]=g[d];u(n),u(n),u(n);for(let d=0;d<2;d++){y[0]=n[0]-65517;for(let j=1;j<15;j++)y[j]=n[j]-65535-(y[j-1]>>16&1),y[j-1]&=65535;y[15]=n[15]-32767-(y[14]>>16&1);const U=y[15]>>16&1;y[14]&=65535,c(n,y,1-U)}for(let d=0;d<16;d++)f[2*d]=n[d]&255,f[2*d+1]=n[d]>>8}function m(f,g){for(let y=0;y<16;y++)f[y]=g[2*y]+(g[2*y+1]<<8);f[15]&=32767}function w(f,g,y){for(let n=0;n<16;n++)f[n]=g[n]+y[n]}function E(f,g,y){for(let n=0;n<16;n++)f[n]=g[n]-y[n]}function P(f,g,y){let n,d,U=0,j=0,Y=0,J=0,X=0,A=0,T=0,W=0,z=0,F=0,M=0,D=0,H=0,ie=0,q=0,Q=0,k=0,oe=0,O=0,I=0,S=0,a=0,b=0,K=0,V=0,le=0,_e=0,de=0,be=0,Fe=0,Pe=0,ye=y[0],ge=y[1],fe=y[2],he=y[3],ce=y[4],ae=y[5],ne=y[6],ee=y[7],ue=y[8],pe=y[9],te=y[10],we=y[11],me=y[12],Ee=y[13],Se=y[14],ve=y[15];n=g[0],U+=n*ye,j+=n*ge,Y+=n*fe,J+=n*he,X+=n*ce,A+=n*ae,T+=n*ne,W+=n*ee,z+=n*ue,F+=n*pe,M+=n*te,D+=n*we,H+=n*me,ie+=n*Ee,q+=n*Se,Q+=n*ve,n=g[1],j+=n*ye,Y+=n*ge,J+=n*fe,X+=n*he,A+=n*ce,T+=n*ae,W+=n*ne,z+=n*ee,F+=n*ue,M+=n*pe,D+=n*te,H+=n*we,ie+=n*me,q+=n*Ee,Q+=n*Se,k+=n*ve,n=g[2],Y+=n*ye,J+=n*ge,X+=n*fe,A+=n*he,T+=n*ce,W+=n*ae,z+=n*ne,F+=n*ee,M+=n*ue,D+=n*pe,H+=n*te,ie+=n*we,q+=n*me,Q+=n*Ee,k+=n*Se,oe+=n*ve,n=g[3],J+=n*ye,X+=n*ge,A+=n*fe,T+=n*he,W+=n*ce,z+=n*ae,F+=n*ne,M+=n*ee,D+=n*ue,H+=n*pe,ie+=n*te,q+=n*we,Q+=n*me,k+=n*Ee,oe+=n*Se,O+=n*ve,n=g[4],X+=n*ye,A+=n*ge,T+=n*fe,W+=n*he,z+=n*ce,F+=n*ae,M+=n*ne,D+=n*ee,H+=n*ue,ie+=n*pe,q+=n*te,Q+=n*we,k+=n*me,oe+=n*Ee,O+=n*Se,I+=n*ve,n=g[5],A+=n*ye,T+=n*ge,W+=n*fe,z+=n*he,F+=n*ce,M+=n*ae,D+=n*ne,H+=n*ee,ie+=n*ue,q+=n*pe,Q+=n*te,k+=n*we,oe+=n*me,O+=n*Ee,I+=n*Se,S+=n*ve,n=g[6],T+=n*ye,W+=n*ge,z+=n*fe,F+=n*he,M+=n*ce,D+=n*ae,H+=n*ne,ie+=n*ee,q+=n*ue,Q+=n*pe,k+=n*te,oe+=n*we,O+=n*me,I+=n*Ee,S+=n*Se,a+=n*ve,n=g[7],W+=n*ye,z+=n*ge,F+=n*fe,M+=n*he,D+=n*ce,H+=n*ae,ie+=n*ne,q+=n*ee,Q+=n*ue,k+=n*pe,oe+=n*te,O+=n*we,I+=n*me,S+=n*Ee,a+=n*Se,b+=n*ve,n=g[8],z+=n*ye,F+=n*ge,M+=n*fe,D+=n*he,H+=n*ce,ie+=n*ae,q+=n*ne,Q+=n*ee,k+=n*ue,oe+=n*pe,O+=n*te,I+=n*we,S+=n*me,a+=n*Ee,b+=n*Se,K+=n*ve,n=g[9],F+=n*ye,M+=n*ge,D+=n*fe,H+=n*he,ie+=n*ce,q+=n*ae,Q+=n*ne,k+=n*ee,oe+=n*ue,O+=n*pe,I+=n*te,S+=n*we,a+=n*me,b+=n*Ee,K+=n*Se,V+=n*ve,n=g[10],M+=n*ye,D+=n*ge,H+=n*fe,ie+=n*he,q+=n*ce,Q+=n*ae,k+=n*ne,oe+=n*ee,O+=n*ue,I+=n*pe,S+=n*te,a+=n*we,b+=n*me,K+=n*Ee,V+=n*Se,le+=n*ve,n=g[11],D+=n*ye,H+=n*ge,ie+=n*fe,q+=n*he,Q+=n*ce,k+=n*ae,oe+=n*ne,O+=n*ee,I+=n*ue,S+=n*pe,a+=n*te,b+=n*we,K+=n*me,V+=n*Ee,le+=n*Se,_e+=n*ve,n=g[12],H+=n*ye,ie+=n*ge,q+=n*fe,Q+=n*he,k+=n*ce,oe+=n*ae,O+=n*ne,I+=n*ee,S+=n*ue,a+=n*pe,b+=n*te,K+=n*we,V+=n*me,le+=n*Ee,_e+=n*Se,de+=n*ve,n=g[13],ie+=n*ye,q+=n*ge,Q+=n*fe,k+=n*he,oe+=n*ce,O+=n*ae,I+=n*ne,S+=n*ee,a+=n*ue,b+=n*pe,K+=n*te,V+=n*we,le+=n*me,_e+=n*Ee,de+=n*Se,be+=n*ve,n=g[14],q+=n*ye,Q+=n*ge,k+=n*fe,oe+=n*he,O+=n*ce,I+=n*ae,S+=n*ne,a+=n*ee,b+=n*ue,K+=n*pe,V+=n*te,le+=n*we,_e+=n*me,de+=n*Ee,be+=n*Se,Fe+=n*ve,n=g[15],Q+=n*ye,k+=n*ge,oe+=n*fe,O+=n*he,I+=n*ce,S+=n*ae,a+=n*ne,b+=n*ee,K+=n*ue,V+=n*pe,le+=n*te,_e+=n*we,de+=n*me,be+=n*Ee,Fe+=n*Se,Pe+=n*ve,U+=38*k,j+=38*oe,Y+=38*O,J+=38*I,X+=38*S,A+=38*a,T+=38*b,W+=38*K,z+=38*V,F+=38*le,M+=38*_e,D+=38*de,H+=38*be,ie+=38*Fe,q+=38*Pe,d=1,n=U+d+65535,d=Math.floor(n/65536),U=n-d*65536,n=j+d+65535,d=Math.floor(n/65536),j=n-d*65536,n=Y+d+65535,d=Math.floor(n/65536),Y=n-d*65536,n=J+d+65535,d=Math.floor(n/65536),J=n-d*65536,n=X+d+65535,d=Math.floor(n/65536),X=n-d*65536,n=A+d+65535,d=Math.floor(n/65536),A=n-d*65536,n=T+d+65535,d=Math.floor(n/65536),T=n-d*65536,n=W+d+65535,d=Math.floor(n/65536),W=n-d*65536,n=z+d+65535,d=Math.floor(n/65536),z=n-d*65536,n=F+d+65535,d=Math.floor(n/65536),F=n-d*65536,n=M+d+65535,d=Math.floor(n/65536),M=n-d*65536,n=D+d+65535,d=Math.floor(n/65536),D=n-d*65536,n=H+d+65535,d=Math.floor(n/65536),H=n-d*65536,n=ie+d+65535,d=Math.floor(n/65536),ie=n-d*65536,n=q+d+65535,d=Math.floor(n/65536),q=n-d*65536,n=Q+d+65535,d=Math.floor(n/65536),Q=n-d*65536,U+=d-1+37*(d-1),d=1,n=U+d+65535,d=Math.floor(n/65536),U=n-d*65536,n=j+d+65535,d=Math.floor(n/65536),j=n-d*65536,n=Y+d+65535,d=Math.floor(n/65536),Y=n-d*65536,n=J+d+65535,d=Math.floor(n/65536),J=n-d*65536,n=X+d+65535,d=Math.floor(n/65536),X=n-d*65536,n=A+d+65535,d=Math.floor(n/65536),A=n-d*65536,n=T+d+65535,d=Math.floor(n/65536),T=n-d*65536,n=W+d+65535,d=Math.floor(n/65536),W=n-d*65536,n=z+d+65535,d=Math.floor(n/65536),z=n-d*65536,n=F+d+65535,d=Math.floor(n/65536),F=n-d*65536,n=M+d+65535,d=Math.floor(n/65536),M=n-d*65536,n=D+d+65535,d=Math.floor(n/65536),D=n-d*65536,n=H+d+65535,d=Math.floor(n/65536),H=n-d*65536,n=ie+d+65535,d=Math.floor(n/65536),ie=n-d*65536,n=q+d+65535,d=Math.floor(n/65536),q=n-d*65536,n=Q+d+65535,d=Math.floor(n/65536),Q=n-d*65536,U+=d-1+37*(d-1),f[0]=U,f[1]=j,f[2]=Y,f[3]=J,f[4]=X,f[5]=A,f[6]=T,f[7]=W,f[8]=z,f[9]=F,f[10]=M,f[11]=D,f[12]=H,f[13]=ie,f[14]=q,f[15]=Q}function v(f,g){P(f,g,g)}function N(f,g){const y=i();for(let n=0;n<16;n++)y[n]=g[n];for(let n=253;n>=0;n--)v(y,y),n!==2&&n!==4&&P(y,y,g);for(let n=0;n<16;n++)f[n]=y[n]}function C(f,g){const y=new Uint8Array(32),n=new Float64Array(80),d=i(),U=i(),j=i(),Y=i(),J=i(),X=i();for(let z=0;z<31;z++)y[z]=f[z];y[31]=f[31]&127|64,y[0]&=248,m(n,g);for(let z=0;z<16;z++)U[z]=n[z];d[0]=Y[0]=1;for(let z=254;z>=0;--z){const F=y[z>>>3]>>>(z&7)&1;c(d,U,F),c(j,Y,F),w(J,d,j),E(d,d,j),w(j,U,Y),E(U,U,Y),v(Y,J),v(X,d),P(d,j,d),P(j,U,J),w(J,d,j),E(d,d,j),v(U,d),E(j,Y,X),P(d,j,o),w(d,d,Y),P(j,j,d),P(d,Y,X),P(Y,U,n),v(U,J),c(d,U,F),c(j,Y,F)}for(let z=0;z<16;z++)n[z+16]=d[z],n[z+32]=j[z],n[z+48]=U[z],n[z+64]=Y[z];const A=n.subarray(32),T=n.subarray(16);N(A,A),P(T,T,A);const W=new Uint8Array(32);return h(W,T),W}t.scalarMult=C;function R(f){return C(f,s)}t.scalarMultBase=R;function $(f){if(f.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const g=new Uint8Array(f);return{publicKey:R(g),secretKey:g}}t.generateKeyPairFromSeed=$;function l(f){const g=(0,e.randomBytes)(32,f),y=$(g);return(0,r.wipe)(g),y}t.generateKeyPair=l;function _(f,g,y=!1){if(f.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(g.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=C(f,g);if(y){let d=0;for(let U=0;U<n.length;U++)d|=n[U];if(d===0)throw new Error("X25519: invalid shared key")}return n}t.sharedKey=_})(qi);var zs=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,o;i<s;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},xh=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),Ih=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Oh=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),Nh=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Th=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Ah=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Ph=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Hs=3,Rh=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Ah]],qs=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Uh(t){return t?Ks(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Th:typeof navigator<"u"?Ks(navigator.userAgent):Ch()}function Lh(t){return t!==""&&Rh.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var o=s.exec(t);return!!o&&[i,o]},!1)}function Ks(t){var e=Lh(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Nh;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<Hs&&(s=zs(zs([],s,!0),Mh(Hs-s.length),!0)):s=[];var o=s.join("."),u=Fh(t),c=Ph.exec(t);return c&&c[1]?new Oh(r,o,u,c[1]):new xh(r,o,u)}function Fh(t){for(var e=0,r=qs.length;e<r;e++){var i=qs[e],s=i[0],o=i[1],u=o.exec(t);if(u)return s}return null}function Ch(){var t=typeof process<"u"&&process.version;return t?new Ih(process.version.slice(1)):null}function Mh(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=ca=Ie.getLocation=Ie.getLocationOrThrow=Ki=Ie.getNavigator=Ie.getNavigatorOrThrow=oa=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function Jt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Ie.getFromWindow=Jt;function nr(t){const e=Jt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Ie.getFromWindowOrThrow=nr;function Dh(){return nr("document")}Ie.getDocumentOrThrow=Dh;function $h(){return Jt("document")}var oa=Ie.getDocument=$h;function jh(){return nr("navigator")}Ie.getNavigatorOrThrow=jh;function zh(){return Jt("navigator")}var Ki=Ie.getNavigator=zh;function Hh(){return nr("location")}Ie.getLocationOrThrow=Hh;function qh(){return Jt("location")}var ca=Ie.getLocation=qh;function Kh(){return nr("crypto")}Ie.getCryptoOrThrow=Kh;function Bh(){return Jt("crypto")}Ie.getCrypto=Bh;function Vh(){return nr("localStorage")}Ie.getLocalStorageOrThrow=Vh;function Gh(){return Jt("localStorage")}Ie.getLocalStorage=Gh;var Bi={};Object.defineProperty(Bi,"__esModule",{value:!0});var ha=Bi.getWindowMetadata=void 0;const Bs=Ie;function Wh(){let t,e;try{t=Bs.getDocumentOrThrow(),e=Bs.getLocationOrThrow()}catch{return null}function r(){const E=t.getElementsByTagName("link"),P=[];for(let v=0;v<E.length;v++){const N=E[v],C=N.getAttribute("rel");if(C&&C.toLowerCase().indexOf("icon")>-1){const R=N.getAttribute("href");if(R)if(R.toLowerCase().indexOf("https:")===-1&&R.toLowerCase().indexOf("http:")===-1&&R.indexOf("//")!==0){let $=e.protocol+"//"+e.host;if(R.indexOf("/")===0)$+=R;else{const l=e.pathname.split("/");l.pop();const _=l.join("/");$+=_+"/"+R}P.push($)}else if(R.indexOf("//")===0){const $=e.protocol+R;P.push($)}else P.push(R)}}return P}function i(...E){const P=t.getElementsByTagName("meta");for(let v=0;v<P.length;v++){const N=P[v],C=["itemprop","property","name"].map(R=>N.getAttribute(R)).filter(R=>R?E.includes(R):!1);if(C.length&&C){const R=N.getAttribute("content");if(R)return R}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=t.title),E}function o(){return i("description","og:description","twitter:description","keywords")}const u=s(),c=o(),h=e.origin,m=r();return{description:c,url:h,icons:m,name:u}}ha=Bi.getWindowMetadata=Wh;var vr={},ua=function(t,e){for(var r={},i=Object.keys(t),s=Array.isArray(e),o=0;o<i.length;o++){var u=i[o],c=t[u];(s?e.indexOf(u)!==-1:e(u,c,t))&&(r[u]=c)}return r};(function(t){const e=Fn,r=Cn,i=Ln,s=ua,o=l=>l==null,u=Symbol("encodeFragmentIdentifier");function c(l){switch(l.arrayFormat){case"index":return _=>(f,g)=>{const y=f.length;return g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[w(_,l),"[",y,"]"].join("")]:[...f,[w(_,l),"[",w(y,l),"]=",w(g,l)].join("")]};case"bracket":return _=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[w(_,l),"[]"].join("")]:[...f,[w(_,l),"[]=",w(g,l)].join("")];case"colon-list-separator":return _=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[w(_,l),":list="].join("")]:[...f,[w(_,l),":list=",w(g,l)].join("")];case"comma":case"separator":case"bracket-separator":{const _=l.arrayFormat==="bracket-separator"?"[]=":"=";return f=>(g,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?g:(y=y===null?"":y,g.length===0?[[w(f,l),_,w(y,l)].join("")]:[[g,w(y,l)].join(l.arrayFormatSeparator)])}default:return _=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,w(_,l)]:[...f,[w(_,l),"=",w(g,l)].join("")]}}function h(l){let _;switch(l.arrayFormat){case"index":return(f,g,y)=>{if(_=/\[(\d*)\]$/.exec(f),f=f.replace(/\[\d*\]$/,""),!_){y[f]=g;return}y[f]===void 0&&(y[f]={}),y[f][_[1]]=g};case"bracket":return(f,g,y)=>{if(_=/(\[\])$/.exec(f),f=f.replace(/\[\]$/,""),!_){y[f]=g;return}if(y[f]===void 0){y[f]=[g];return}y[f]=[].concat(y[f],g)};case"colon-list-separator":return(f,g,y)=>{if(_=/(:list)$/.exec(f),f=f.replace(/:list$/,""),!_){y[f]=g;return}if(y[f]===void 0){y[f]=[g];return}y[f]=[].concat(y[f],g)};case"comma":case"separator":return(f,g,y)=>{const n=typeof g=="string"&&g.includes(l.arrayFormatSeparator),d=typeof g=="string"&&!n&&E(g,l).includes(l.arrayFormatSeparator);g=d?E(g,l):g;const U=n||d?g.split(l.arrayFormatSeparator).map(j=>E(j,l)):g===null?g:E(g,l);y[f]=U};case"bracket-separator":return(f,g,y)=>{const n=/(\[\])$/.test(f);if(f=f.replace(/\[\]$/,""),!n){y[f]=g&&E(g,l);return}const d=g===null?[]:g.split(l.arrayFormatSeparator).map(U=>E(U,l));if(y[f]===void 0){y[f]=d;return}y[f]=[].concat(y[f],d)};default:return(f,g,y)=>{if(y[f]===void 0){y[f]=g;return}y[f]=[].concat(y[f],g)}}}function m(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function w(l,_){return _.encode?_.strict?e(l):encodeURIComponent(l):l}function E(l,_){return _.decode?r(l):l}function P(l){return Array.isArray(l)?l.sort():typeof l=="object"?P(Object.keys(l)).sort((_,f)=>Number(_)-Number(f)).map(_=>l[_]):l}function v(l){const _=l.indexOf("#");return _!==-1&&(l=l.slice(0,_)),l}function N(l){let _="";const f=l.indexOf("#");return f!==-1&&(_=l.slice(f)),_}function C(l){l=v(l);const _=l.indexOf("?");return _===-1?"":l.slice(_+1)}function R(l,_){return _.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):_.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function $(l,_){_=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},_),m(_.arrayFormatSeparator);const f=h(_),g=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return g;for(const y of l.split("&")){if(y==="")continue;let[n,d]=i(_.decode?y.replace(/\+/g," "):y,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(_.arrayFormat)?d:E(d,_),f(E(n,_),d,g)}for(const y of Object.keys(g)){const n=g[y];if(typeof n=="object"&&n!==null)for(const d of Object.keys(n))n[d]=R(n[d],_);else g[y]=R(n,_)}return _.sort===!1?g:(_.sort===!0?Object.keys(g).sort():Object.keys(g).sort(_.sort)).reduce((y,n)=>{const d=g[n];return Boolean(d)&&typeof d=="object"&&!Array.isArray(d)?y[n]=P(d):y[n]=d,y},Object.create(null))}t.extract=C,t.parse=$,t.stringify=(l,_)=>{if(!l)return"";_=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},_),m(_.arrayFormatSeparator);const f=d=>_.skipNull&&o(l[d])||_.skipEmptyString&&l[d]==="",g=c(_),y={};for(const d of Object.keys(l))f(d)||(y[d]=l[d]);const n=Object.keys(y);return _.sort!==!1&&n.sort(_.sort),n.map(d=>{const U=l[d];return U===void 0?"":U===null?w(d,_):Array.isArray(U)?U.length===0&&_.arrayFormat==="bracket-separator"?w(d,_)+"[]":U.reduce(g(d),[]).join("&"):w(d,_)+"="+w(U,_)}).filter(d=>d.length>0).join("&")},t.parseUrl=(l,_)=>{_=Object.assign({decode:!0},_);const[f,g]=i(l,"#");return Object.assign({url:f.split("?")[0]||"",query:$(C(l),_)},_&&_.parseFragmentIdentifier&&g?{fragmentIdentifier:E(g,_)}:{})},t.stringifyUrl=(l,_)=>{_=Object.assign({encode:!0,strict:!0,[u]:!0},_);const f=v(l.url).split("?")[0]||"",g=t.extract(l.url),y=t.parse(g,{sort:!1}),n=Object.assign(y,l.query);let d=t.stringify(n,_);d&&(d=`?${d}`);let U=N(l.url);return l.fragmentIdentifier&&(U=`#${_[u]?w(l.fragmentIdentifier,_):l.fragmentIdentifier}`),`${f}${d}${U}`},t.pick=(l,_,f)=>{f=Object.assign({parseFragmentIdentifier:!0,[u]:!1},f);const{url:g,query:y,fragmentIdentifier:n}=t.parseUrl(l,f);return t.stringifyUrl({url:g,query:s(y,_),fragmentIdentifier:n},f)},t.exclude=(l,_,f)=>{const g=Array.isArray(_)?y=>!_.includes(y):(y,n)=>!_(y,n);return t.pick(l,g,f)}})(vr);const kh={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},la="base10",ot="base16",Ii="base64pad",Vi="utf8",fa=0,Xt=1,Yh=0,Vs=1,Oi=12,Gi=32;function Jh(){const t=qi.generateKeyPair();return{privateKey:ct(t.secretKey,ot),publicKey:ct(t.publicKey,ot)}}function Ni(){const t=sr.randomBytes(Gi);return ct(t,ot)}function Xh(t,e){const r=qi.sharedKey(at(t,ot),at(e,ot)),i=new Sh(ei.SHA256,r).expand(Gi);return ct(i,ot)}function Zh(t){const e=ei.hash(at(t,ot));return ct(e,ot)}function Ti(t){const e=ei.hash(at(t,Vi));return ct(e,ot)}function Qh(t){return at(`${t}`,la)}function Or(t){return Number(ct(t,la))}function eu(t){const e=Qh(typeof t.type<"u"?t.type:fa);if(Or(e)===Xt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?at(t.senderPublicKey,ot):void 0,i=typeof t.iv<"u"?at(t.iv,ot):sr.randomBytes(Oi),s=new zi.ChaCha20Poly1305(at(t.symKey,ot)).seal(i,at(t.message,Vi));return ru({type:e,sealed:s,iv:i,senderPublicKey:r})}function tu(t){const e=new zi.ChaCha20Poly1305(at(t.symKey,ot)),{sealed:r,iv:i}=Wi(t.encoded),s=e.open(i,r);if(s===null)throw new Error("Failed to decrypt");return ct(s,Vi)}function ru(t){if(Or(t.type)===Xt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ct(wi([t.type,t.senderPublicKey,t.iv,t.sealed]),Ii)}return ct(wi([t.type,t.iv,t.sealed]),Ii)}function Wi(t){const e=at(t,Ii),r=e.slice(Yh,Vs),i=Vs;if(Or(r)===Xt){const c=i+Gi,h=c+Oi,m=e.slice(i,c),w=e.slice(c,h),E=e.slice(h);return{type:r,sealed:E,iv:w,senderPublicKey:m}}const s=i+Oi,o=e.slice(i,s),u=e.slice(s);return{type:r,sealed:u,iv:o}}function iu(t,e){const r=Wi(t);return da({type:Or(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ct(r.senderPublicKey,ot):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function da(t){const e=(t==null?void 0:t.type)||fa;if(e===Xt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Gs(t){return t.type===Xt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var su=Object.defineProperty,Ws=Object.getOwnPropertySymbols,nu=Object.prototype.hasOwnProperty,au=Object.prototype.propertyIsEnumerable,ks=(t,e,r)=>e in t?su(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ys=(t,e)=>{for(var r in e||(e={}))nu.call(e,r)&&ks(t,r,e[r]);if(Ws)for(var r of Ws(e))au.call(e,r)&&ks(t,r,e[r]);return t};const ou="ReactNative",wr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},cu="js";function ga(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function hu(){return!oa()&&!!Ki()&&navigator.product===ou}function uu(){return!ga()&&!!Ki()}function lu(){return hu()?wr.reactNative:ga()?wr.node:uu()?wr.browser:wr.unknown}function fu(t,e){let r=vr.parse(t);return r=Ys(Ys({},r),e),t=vr.stringify(r),t}function du(){return ha()||{name:"",description:"",url:"",icons:[""]}}function gu(){const t=Uh();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function pu(){var t;const e=lu();return e===wr.browser?[e,((t=ca())==null?void 0:t.host)||"unknown"].join(":"):e}function yu(t,e,r){const i=gu(),s=pu();return[[t,e].join("-"),[cu,r].join("-"),i,s].join("/")}function _u({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:o}){const u=r.split("?"),c=yu(t,e,i),h={auth:s,ua:c,projectId:o},m=fu(u[1]||"",h);return u[0]+"?"+m}function nt(t,e){return t.filter(r=>e.includes(r)).length===t.length}function pa(t){return Object.fromEntries(t.entries())}function ya(t){return new Map(Object.entries(t))}function xt(t,e){return Z.fromMiliseconds((e||Date.now())+Z.toMiliseconds(t))}function Mt(t){return Z.fromMiliseconds(Date.now())>=Z.toMiliseconds(t)}function Wt(t){const e=Z.toMiliseconds(t||Z.FIVE_MINUTES);let r,i,s;return{resolve:o=>{s&&r&&(clearTimeout(s),r(o))},reject:o=>{s&&i&&(clearTimeout(s),i(o))},done:()=>new Promise((o,u)=>{s=setTimeout(u,e),r=o,i=u})}}function _a(t,e){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(),e),o=await t;clearTimeout(s),r(o)})}function wa(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function wu(t){return wa("topic",t)}function mu(t){return wa("id",t)}function ma(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Ce(t,e){return`${t}${e?`:${e}`:""}`}const bu="irn";function Ai(t){return(t==null?void 0:t.relay)||{protocol:bu}}function Pi(t){const e=kh[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var vu=Object.defineProperty,Js=Object.getOwnPropertySymbols,Eu=Object.prototype.hasOwnProperty,Su=Object.prototype.propertyIsEnumerable,Xs=(t,e,r)=>e in t?vu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xu=(t,e)=>{for(var r in e||(e={}))Eu.call(e,r)&&Xs(t,r,e[r]);if(Js)for(var r of Js(e))Su.call(e,r)&&Xs(t,r,e[r]);return t};function Iu(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const o=s.replace(i,""),u=t[s];r[o]=u}}),r}function Ou(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),o=typeof r<"u"?t.substring(r):"",u=vr.parse(o);return{protocol:i,topic:s[0],version:parseInt(s[1],10),symKey:u.symKey,relay:Iu(u)}}function Nu(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const o=r+e+s;t[s]&&(i[o]=t[s])}),i}function Tu(t){return`${t.protocol}:${t.topic}@${t.version}?`+vr.stringify(xu({symKey:t.symKey},Nu(t.relay)))}function Ot(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function Au(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Ot(r.accounts)),r.extension&&r.extension.forEach(i=>{e.push(...Ot(i.accounts))})}),e}function Pu(t,e){const r=[];return Object.values(t).forEach(i=>{Ot(i.accounts).includes(e)&&r.push(...i.methods),i.extension&&i.extension.forEach(s=>{Ot(s.accounts).includes(e)&&r.push(...s.methods)})}),r}function Ru(t,e){const r=[];return Object.values(t).forEach(i=>{Ot(i.accounts).includes(e)&&r.push(...i.events),i.extension&&i.extension.forEach(s=>{Ot(s.accounts).includes(e)&&r.push(...s.events)})}),r}function Uu(t,e){const r=zr(t,e);if(r)throw new Error(r.message);const i={};for(const[s,o]of Object.entries(t))i[s]={methods:o.methods,events:o.events,chains:o.accounts.map(u=>`${u.split(":")[0]}:${u.split(":")[1]}`)};return i}const Lu={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Fu={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function B(t,e){const{message:r,code:i}=Fu[t];return{message:e?`${r} ${e}`:r,code:i}}function Je(t,e){const{message:r,code:i}=Lu[t];return{message:e?`${r} ${e}`:r,code:i}}function Nr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Vr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function lt(t){return typeof t>"u"}function Ze(t,e){return e&&lt(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function ki(t,e){return e&&lt(t)?!0:typeof t=="number"&&!isNaN(t)}function Cu(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let o=!0;return nt(s,i)?(i.forEach(u=>{const{accounts:c,methods:h,events:m,extension:w}=t.namespaces[u],E=Ot(c),P=r[u];(!nt(P.chains,E)||!nt(P.methods,h)||!nt(P.events,m))&&(o=!1),o&&w&&w.forEach(v=>{var N;const{accounts:C,methods:R,events:$}=v,l=Ot(C);(N=P.extension)!=null&&N.find(_=>nt(_.chains,l)&&nt(_.methods,R)&&nt(_.events,$))||(o=!1)})}),o):!1}function Yi(t){return Ze(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Mu(t){if(Ze(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Yi(r)}}return!1}function Du(t){if(Ze(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function $u(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function ju(t){return t==null?void 0:t.topic}function zu(t,e){let r=null;return Ze(t==null?void 0:t.publicKey,!1)||(r=B("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Ji(t,e){let r=null;return lt(t==null?void 0:t.extension)||(!Nr(t.extension)||!t.extension.length)&&(r=B("MISSING_OR_INVALID",`${e} extension should be an array of namespaces, or omitted`)),r}function Zs(t){let e=!0;return Nr(t)?t.length&&(e=t.every(r=>Ze(r,!1))):e=!1,e}function Qs(t,e,r){let i=null;return Nr(e)?e.forEach(s=>{i||(!Yi(s)||!s.includes(t))&&(i=Je("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):i=Je("UNSUPPORTED_CHAINS",`${r}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function Hu(t,e){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;const o=Qs(i,s==null?void 0:s.chains,`${e} requiredNamespace`),u=Ji(s,e);o?r=o:u?r=u:s.extension&&s.extension.forEach(c=>{if(r)return;const h=Qs(i,c.chains,`${e} extension`);h&&(r=h)})}),r}function en(t,e){let r=null;return Nr(t)?t.forEach(i=>{r||Mu(i)||(r=Je("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=Je("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function qu(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=en(i==null?void 0:i.accounts,`${e} namespace`),o=Ji(i,e);s?r=s:o?r=o:i.extension&&i.extension.forEach(u=>{if(r)return;const c=en(u.accounts,`${e} extension`);c&&(r=c)})}),r}function tn(t,e){let r=null;return Zs(t==null?void 0:t.methods)?Zs(t==null?void 0:t.events)||(r=Je("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Je("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function ba(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=tn(i,`${e}, namespace`),o=Ji(i,e);s?r=s:o?r=o:i.extension&&i.extension.forEach(u=>{if(r)return;const c=tn(u,`${e}, extension`);c&&(r=c)})}),r}function Ku(t,e){let r=null;if(t&&Vr(t)){const i=ba(t,e);i&&(r=i);const s=Hu(t,e);s&&(r=s)}else r=B("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return r}function zr(t,e){let r=null;if(t&&Vr(t)){const i=ba(t,e);i&&(r=i);const s=qu(t,e);s&&(r=s)}else r=B("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function va(t){return Ze(t.protocol,!0)}function Bu(t,e){let r=!1;return e&&!t?r=!0:t&&Nr(t)&&t.length&&t.forEach(i=>{r=va(i)}),r}function Vu(t){return typeof t=="number"}function st(t){return typeof t<"u"&&typeof t!==null}function Gu(t){return!(!t||typeof t!="object"||!t.code||!ki(t.code,!1)||!t.message||!Ze(t.message,!1))}function Wu(t){return!(lt(t)||!Ze(t.method,!1))}function ku(t){return!(lt(t)||lt(t.result)&&lt(t.error)||!ki(t.id,!1)||!Ze(t.jsonrpc,!1))}function Yu(t){return!(lt(t)||!Ze(t.name,!1))}function rn(t,e){return!(!Yi(e)||!Au(t).includes(e))}function Ju(t,e,r){return Ze(r,!1)?Pu(t,e).includes(r):!1}function Xu(t,e,r){return Ze(r,!1)?Ru(t,e).includes(r):!1}function sn(t,e,r){let i=null;const s=Object.keys(t),o=Object.keys(e);return nt(s,o)?s.forEach(u=>{var c;if(i)return;const h=t[u].chains,m=Ot(e[u].accounts);nt(h,m)?nt(t[u].methods,e[u].methods)?nt(t[u].events,e[u].events)?t[u].extension&&!e[u].extension?i=B("NON_CONFORMING_NAMESPACES",`${r} namespaces extension doesn't satisfy requiredNamespaces extension for ${u}`):t[u].extension&&e[u].extension&&((c=t[u].extension)==null||c.forEach(({methods:w,events:E,chains:P})=>{var v;i||(v=e[u].extension)!=null&&v.find(N=>{const C=Ot(N.accounts);return nt(P,C)&&nt(E,N.events)&&nt(w,N.methods)})||(i=B("NON_CONFORMING_NAMESPACES",`${r} namespaces extension doesn't satisfy requiredNamespaces extension for ${u}`))})):i=B("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy requiredNamespaces events for ${u}`):i=B("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy requiredNamespaces methods for ${u}`):i=B("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy requiredNamespaces chains for ${u}`)}):i=B("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces`),i}function Zu(t,e){return ki(t,!1)&&t<=e.max&&t>=e.min}const nn=10,Qu=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),el=()=>typeof window<"u",tl=Qu();class rl{constructor(e){if(this.url=e,this.events=new yt.EventEmitter,this.registering=!1,!fs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Li(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!fs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=To.isReactNative()?void 0:{rejectUnauthorized:!Ao(e)},o=new tl(e,[],s);el()?o.onerror=u=>{const c=u;i(this.emitError(c.error))}:o.on("error",u=>{i(this.emitError(u))}),o.onopen=()=>{this.onOpen(o),r(o)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Mn(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),o=Fi(e,s);this.events.emit("payload",o)}parseError(e,r=this.url){return Po(e,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>nn&&this.events.setMaxListeners(nn)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var Gr={},il={get exports(){return Gr},set exports(t){Gr=t}};(function(t,e){var r=200,i="__lodash_hash_undefined__",s=1,o=2,u=9007199254740991,c="[object Arguments]",h="[object Array]",m="[object AsyncFunction]",w="[object Boolean]",E="[object Date]",P="[object Error]",v="[object Function]",N="[object GeneratorFunction]",C="[object Map]",R="[object Number]",$="[object Null]",l="[object Object]",_="[object Promise]",f="[object Proxy]",g="[object RegExp]",y="[object Set]",n="[object String]",d="[object Symbol]",U="[object Undefined]",j="[object WeakMap]",Y="[object ArrayBuffer]",J="[object DataView]",X="[object Float32Array]",A="[object Float64Array]",T="[object Int8Array]",W="[object Int16Array]",z="[object Int32Array]",F="[object Uint8Array]",M="[object Uint8ClampedArray]",D="[object Uint16Array]",H="[object Uint32Array]",ie=/[\\^$.*+?()[\]{}|]/g,q=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,k={};k[X]=k[A]=k[T]=k[W]=k[z]=k[F]=k[M]=k[D]=k[H]=!0,k[c]=k[h]=k[Y]=k[w]=k[J]=k[E]=k[P]=k[v]=k[C]=k[R]=k[l]=k[g]=k[y]=k[n]=k[j]=!1;var oe=typeof kt=="object"&&kt&&kt.Object===Object&&kt,O=typeof self=="object"&&self&&self.Object===Object&&self,I=oe||O||Function("return this")(),S=e&&!e.nodeType&&e,a=S&&!0&&t&&!t.nodeType&&t,b=a&&a.exports===S,K=b&&oe.process,V=function(){try{return K&&K.binding&&K.binding("util")}catch{}}(),le=V&&V.isTypedArray;function _e(p,x){for(var L=-1,G=p==null?0:p.length,Ne=0,se=[];++L<G;){var Le=p[L];x(Le,L,p)&&(se[Ne++]=Le)}return se}function de(p,x){for(var L=-1,G=x.length,Ne=p.length;++L<G;)p[Ne+L]=x[L];return p}function be(p,x){for(var L=-1,G=p==null?0:p.length;++L<G;)if(x(p[L],L,p))return!0;return!1}function Fe(p,x){for(var L=-1,G=Array(p);++L<p;)G[L]=x(L);return G}function Pe(p){return function(x){return p(x)}}function ye(p,x){return p.has(x)}function ge(p,x){return p==null?void 0:p[x]}function fe(p){var x=-1,L=Array(p.size);return p.forEach(function(G,Ne){L[++x]=[Ne,G]}),L}function he(p,x){return function(L){return p(x(L))}}function ce(p){var x=-1,L=Array(p.size);return p.forEach(function(G){L[++x]=G}),L}var ae=Array.prototype,ne=Function.prototype,ee=Object.prototype,ue=I["__core-js_shared__"],pe=ne.toString,te=ee.hasOwnProperty,we=function(){var p=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),me=ee.toString,Ee=RegExp("^"+pe.call(te).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Se=b?I.Buffer:void 0,ve=I.Symbol,_t=I.Uint8Array,bt=ee.propertyIsEnumerable,Rt=ae.splice,ht=ve?ve.toStringTag:void 0,jt=Object.getOwnPropertySymbols,or=Se?Se.isBuffer:void 0,Ar=he(Object.keys,Object),Me=Qt(I,"DataView"),Re=Qt(I,"Map"),De=Qt(I,"Promise"),$e=Qt(I,"Set"),je=Qt(I,"WeakMap"),Ue=Qt(Object,"create"),qe=Ht(Me),Ke=Ht(Re),Be=Ht(De),Ve=Ht($e),Ge=Ht(je),He=ve?ve.prototype:void 0,ze=He?He.valueOf:void 0;function Te(p){var x=-1,L=p==null?0:p.length;for(this.clear();++x<L;){var G=p[x];this.set(G[0],G[1])}}function We(){this.__data__=Ue?Ue(null):{},this.size=0}function ke(p){var x=this.has(p)&&delete this.__data__[p];return this.size-=x?1:0,x}function $a(p){var x=this.__data__;if(Ue){var L=x[p];return L===i?void 0:L}return te.call(x,p)?x[p]:void 0}function ja(p){var x=this.__data__;return Ue?x[p]!==void 0:te.call(x,p)}function za(p,x){var L=this.__data__;return this.size+=this.has(p)?0:1,L[p]=Ue&&x===void 0?i:x,this}Te.prototype.clear=We,Te.prototype.delete=ke,Te.prototype.get=$a,Te.prototype.has=ja,Te.prototype.set=za;function Nt(p){var x=-1,L=p==null?0:p.length;for(this.clear();++x<L;){var G=p[x];this.set(G[0],G[1])}}function Ha(){this.__data__=[],this.size=0}function qa(p){var x=this.__data__,L=Rr(x,p);if(L<0)return!1;var G=x.length-1;return L==G?x.pop():Rt.call(x,L,1),--this.size,!0}function Ka(p){var x=this.__data__,L=Rr(x,p);return L<0?void 0:x[L][1]}function Ba(p){return Rr(this.__data__,p)>-1}function Va(p,x){var L=this.__data__,G=Rr(L,p);return G<0?(++this.size,L.push([p,x])):L[G][1]=x,this}Nt.prototype.clear=Ha,Nt.prototype.delete=qa,Nt.prototype.get=Ka,Nt.prototype.has=Ba,Nt.prototype.set=Va;function zt(p){var x=-1,L=p==null?0:p.length;for(this.clear();++x<L;){var G=p[x];this.set(G[0],G[1])}}function Ga(){this.size=0,this.__data__={hash:new Te,map:new(Re||Nt),string:new Te}}function Wa(p){var x=Ur(this,p).delete(p);return this.size-=x?1:0,x}function ka(p){return Ur(this,p).get(p)}function Ya(p){return Ur(this,p).has(p)}function Ja(p,x){var L=Ur(this,p),G=L.size;return L.set(p,x),this.size+=L.size==G?0:1,this}zt.prototype.clear=Ga,zt.prototype.delete=Wa,zt.prototype.get=ka,zt.prototype.has=Ya,zt.prototype.set=Ja;function Pr(p){var x=-1,L=p==null?0:p.length;for(this.__data__=new zt;++x<L;)this.add(p[x])}function Xa(p){return this.__data__.set(p,i),this}function Za(p){return this.__data__.has(p)}Pr.prototype.add=Pr.prototype.push=Xa,Pr.prototype.has=Za;function Ut(p){var x=this.__data__=new Nt(p);this.size=x.size}function Qa(){this.__data__=new Nt,this.size=0}function eo(p){var x=this.__data__,L=x.delete(p);return this.size=x.size,L}function to(p){return this.__data__.get(p)}function ro(p){return this.__data__.has(p)}function io(p,x){var L=this.__data__;if(L instanceof Nt){var G=L.__data__;if(!Re||G.length<r-1)return G.push([p,x]),this.size=++L.size,this;L=this.__data__=new zt(G)}return L.set(p,x),this.size=L.size,this}Ut.prototype.clear=Qa,Ut.prototype.delete=eo,Ut.prototype.get=to,Ut.prototype.has=ro,Ut.prototype.set=io;function so(p,x){var L=Lr(p),G=!L&&bo(p),Ne=!L&&!G&&ii(p),se=!L&&!G&&!Ne&&us(p),Le=L||G||Ne||se,Ye=Le?Fe(p.length,String):[],Xe=Ye.length;for(var Ae in p)(x||te.call(p,Ae))&&!(Le&&(Ae=="length"||Ne&&(Ae=="offset"||Ae=="parent")||se&&(Ae=="buffer"||Ae=="byteLength"||Ae=="byteOffset")||po(Ae,Xe)))&&Ye.push(Ae);return Ye}function Rr(p,x){for(var L=p.length;L--;)if(as(p[L][0],x))return L;return-1}function no(p,x,L){var G=x(p);return Lr(p)?G:de(G,L(p))}function cr(p){return p==null?p===void 0?U:$:ht&&ht in Object(p)?fo(p):mo(p)}function rs(p){return hr(p)&&cr(p)==c}function is(p,x,L,G,Ne){return p===x?!0:p==null||x==null||!hr(p)&&!hr(x)?p!==p&&x!==x:ao(p,x,L,G,is,Ne)}function ao(p,x,L,G,Ne,se){var Le=Lr(p),Ye=Lr(x),Xe=Le?h:Lt(p),Ae=Ye?h:Lt(x);Xe=Xe==c?l:Xe,Ae=Ae==c?l:Ae;var ut=Xe==l,wt=Ae==l,et=Xe==Ae;if(et&&ii(p)){if(!ii(x))return!1;Le=!0,ut=!1}if(et&&!ut)return se||(se=new Ut),Le||us(p)?ss(p,x,L,G,Ne,se):uo(p,x,Xe,L,G,Ne,se);if(!(L&s)){var dt=ut&&te.call(p,"__wrapped__"),gt=wt&&te.call(x,"__wrapped__");if(dt||gt){var Ft=dt?p.value():p,Tt=gt?x.value():x;return se||(se=new Ut),Ne(Ft,Tt,L,G,se)}}return et?(se||(se=new Ut),lo(p,x,L,G,Ne,se)):!1}function oo(p){if(!hs(p)||_o(p))return!1;var x=os(p)?Ee:q;return x.test(Ht(p))}function co(p){return hr(p)&&cs(p.length)&&!!k[cr(p)]}function ho(p){if(!wo(p))return Ar(p);var x=[];for(var L in Object(p))te.call(p,L)&&L!="constructor"&&x.push(L);return x}function ss(p,x,L,G,Ne,se){var Le=L&s,Ye=p.length,Xe=x.length;if(Ye!=Xe&&!(Le&&Xe>Ye))return!1;var Ae=se.get(p);if(Ae&&se.get(x))return Ae==x;var ut=-1,wt=!0,et=L&o?new Pr:void 0;for(se.set(p,x),se.set(x,p);++ut<Ye;){var dt=p[ut],gt=x[ut];if(G)var Ft=Le?G(gt,dt,ut,x,p,se):G(dt,gt,ut,p,x,se);if(Ft!==void 0){if(Ft)continue;wt=!1;break}if(et){if(!be(x,function(Tt,qt){if(!ye(et,qt)&&(dt===Tt||Ne(dt,Tt,L,G,se)))return et.push(qt)})){wt=!1;break}}else if(!(dt===gt||Ne(dt,gt,L,G,se))){wt=!1;break}}return se.delete(p),se.delete(x),wt}function uo(p,x,L,G,Ne,se,Le){switch(L){case J:if(p.byteLength!=x.byteLength||p.byteOffset!=x.byteOffset)return!1;p=p.buffer,x=x.buffer;case Y:return!(p.byteLength!=x.byteLength||!se(new _t(p),new _t(x)));case w:case E:case R:return as(+p,+x);case P:return p.name==x.name&&p.message==x.message;case g:case n:return p==x+"";case C:var Ye=fe;case y:var Xe=G&s;if(Ye||(Ye=ce),p.size!=x.size&&!Xe)return!1;var Ae=Le.get(p);if(Ae)return Ae==x;G|=o,Le.set(p,x);var ut=ss(Ye(p),Ye(x),G,Ne,se,Le);return Le.delete(p),ut;case d:if(ze)return ze.call(p)==ze.call(x)}return!1}function lo(p,x,L,G,Ne,se){var Le=L&s,Ye=ns(p),Xe=Ye.length,Ae=ns(x),ut=Ae.length;if(Xe!=ut&&!Le)return!1;for(var wt=Xe;wt--;){var et=Ye[wt];if(!(Le?et in x:te.call(x,et)))return!1}var dt=se.get(p);if(dt&&se.get(x))return dt==x;var gt=!0;se.set(p,x),se.set(x,p);for(var Ft=Le;++wt<Xe;){et=Ye[wt];var Tt=p[et],qt=x[et];if(G)var ls=Le?G(qt,Tt,et,x,p,se):G(Tt,qt,et,p,x,se);if(!(ls===void 0?Tt===qt||Ne(Tt,qt,L,G,se):ls)){gt=!1;break}Ft||(Ft=et=="constructor")}if(gt&&!Ft){var Fr=p.constructor,Cr=x.constructor;Fr!=Cr&&"constructor"in p&&"constructor"in x&&!(typeof Fr=="function"&&Fr instanceof Fr&&typeof Cr=="function"&&Cr instanceof Cr)&&(gt=!1)}return se.delete(p),se.delete(x),gt}function ns(p){return no(p,So,go)}function Ur(p,x){var L=p.__data__;return yo(x)?L[typeof x=="string"?"string":"hash"]:L.map}function Qt(p,x){var L=ge(p,x);return oo(L)?L:void 0}function fo(p){var x=te.call(p,ht),L=p[ht];try{p[ht]=void 0;var G=!0}catch{}var Ne=me.call(p);return G&&(x?p[ht]=L:delete p[ht]),Ne}var go=jt?function(p){return p==null?[]:(p=Object(p),_e(jt(p),function(x){return bt.call(p,x)}))}:xo,Lt=cr;(Me&&Lt(new Me(new ArrayBuffer(1)))!=J||Re&&Lt(new Re)!=C||De&&Lt(De.resolve())!=_||$e&&Lt(new $e)!=y||je&&Lt(new je)!=j)&&(Lt=function(p){var x=cr(p),L=x==l?p.constructor:void 0,G=L?Ht(L):"";if(G)switch(G){case qe:return J;case Ke:return C;case Be:return _;case Ve:return y;case Ge:return j}return x});function po(p,x){return x=x??u,!!x&&(typeof p=="number"||Q.test(p))&&p>-1&&p%1==0&&p<x}function yo(p){var x=typeof p;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?p!=="__proto__":p===null}function _o(p){return!!we&&we in p}function wo(p){var x=p&&p.constructor,L=typeof x=="function"&&x.prototype||ee;return p===L}function mo(p){return me.call(p)}function Ht(p){if(p!=null){try{return pe.call(p)}catch{}try{return p+""}catch{}}return""}function as(p,x){return p===x||p!==p&&x!==x}var bo=rs(function(){return arguments}())?rs:function(p){return hr(p)&&te.call(p,"callee")&&!bt.call(p,"callee")},Lr=Array.isArray;function vo(p){return p!=null&&cs(p.length)&&!os(p)}var ii=or||Io;function Eo(p,x){return is(p,x)}function os(p){if(!hs(p))return!1;var x=cr(p);return x==v||x==N||x==m||x==f}function cs(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=u}function hs(p){var x=typeof p;return p!=null&&(x=="object"||x=="function")}function hr(p){return p!=null&&typeof p=="object"}var us=le?Pe(le):co;function So(p){return vo(p)?so(p):ho(p)}function xo(){return[]}function Io(){return!1}t.exports=Eo})(il,Gr);function sl(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var o=t.charAt(s),u=o.charCodeAt(0);if(r[u]!==255)throw new TypeError(o+" is ambiguous");r[u]=s}var c=t.length,h=t.charAt(0),m=Math.log(c)/Math.log(256),w=Math.log(256)/Math.log(c);function E(N){if(N instanceof Uint8Array||(ArrayBuffer.isView(N)?N=new Uint8Array(N.buffer,N.byteOffset,N.byteLength):Array.isArray(N)&&(N=Uint8Array.from(N))),!(N instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(N.length===0)return"";for(var C=0,R=0,$=0,l=N.length;$!==l&&N[$]===0;)$++,C++;for(var _=(l-$)*w+1>>>0,f=new Uint8Array(_);$!==l;){for(var g=N[$],y=0,n=_-1;(g!==0||y<R)&&n!==-1;n--,y++)g+=256*f[n]>>>0,f[n]=g%c>>>0,g=g/c>>>0;if(g!==0)throw new Error("Non-zero carry");R=y,$++}for(var d=_-R;d!==_&&f[d]===0;)d++;for(var U=h.repeat(C);d<_;++d)U+=t.charAt(f[d]);return U}function P(N){if(typeof N!="string")throw new TypeError("Expected String");if(N.length===0)return new Uint8Array;var C=0;if(N[C]!==" "){for(var R=0,$=0;N[C]===h;)R++,C++;for(var l=(N.length-C)*m+1>>>0,_=new Uint8Array(l);N[C];){var f=r[N.charCodeAt(C)];if(f===255)return;for(var g=0,y=l-1;(f!==0||g<$)&&y!==-1;y--,g++)f+=c*_[y]>>>0,_[y]=f%256>>>0,f=f/256>>>0;if(f!==0)throw new Error("Non-zero carry");$=g,C++}if(N[C]!==" "){for(var n=l-$;n!==l&&_[n]===0;)n++;for(var d=new Uint8Array(R+(l-n)),U=R;n!==l;)d[U++]=_[n++];return d}}}function v(N){var C=P(N);if(C)return C;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:P,decode:v}}var nl=sl,al=nl;const Ea=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},ol=t=>new TextEncoder().encode(t),cl=t=>new TextDecoder().decode(t);class hl{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ul{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Sa(this,e)}}class ll{constructor(e){this.decoders=e}or(e){return Sa(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Sa=(t,e)=>new ll({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class fl{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new hl(e,r,i),this.decoder=new ul(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ti=({name:t,prefix:e,encode:r,decode:i})=>new fl(t,e,r,i),Tr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=al(r,e);return ti({prefix:t,name:e,encode:i,decode:o=>Ea(s(o))})},dl=(t,e,r,i)=>{const s={};for(let w=0;w<e.length;++w)s[e[w]]=w;let o=t.length;for(;t[o-1]==="=";)--o;const u=new Uint8Array(o*r/8|0);let c=0,h=0,m=0;for(let w=0;w<o;++w){const E=s[t[w]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|E,c+=r,c>=8&&(c-=8,u[m++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},gl=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let o="",u=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],u+=8;u>r;)u-=r,o+=e[s&c>>u];if(u&&(o+=e[s&c<<r-u]),i)for(;o.length*r&7;)o+="=";return o},Qe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ti({prefix:e,name:t,encode(s){return gl(s,i,r)},decode(s){return dl(s,i,r,t)}}),pl=ti({prefix:"\0",name:"identity",encode:t=>cl(t),decode:t=>ol(t)});var yl=Object.freeze({__proto__:null,identity:pl});const _l=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var wl=Object.freeze({__proto__:null,base2:_l});const ml=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var bl=Object.freeze({__proto__:null,base8:ml});const vl=Tr({prefix:"9",name:"base10",alphabet:"0123456789"});var El=Object.freeze({__proto__:null,base10:vl});const Sl=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xl=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Il=Object.freeze({__proto__:null,base16:Sl,base16upper:xl});const Ol=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Nl=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Tl=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Al=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Pl=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Rl=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ul=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ll=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Fl=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Cl=Object.freeze({__proto__:null,base32:Ol,base32upper:Nl,base32pad:Tl,base32padupper:Al,base32hex:Pl,base32hexupper:Rl,base32hexpad:Ul,base32hexpadupper:Ll,base32z:Fl});const Ml=Tr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Dl=Tr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var $l=Object.freeze({__proto__:null,base36:Ml,base36upper:Dl});const jl=Tr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),zl=Tr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Hl=Object.freeze({__proto__:null,base58btc:jl,base58flickr:zl});const ql=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Kl=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Bl=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Vl=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Gl=Object.freeze({__proto__:null,base64:ql,base64pad:Kl,base64url:Bl,base64urlpad:Vl});const xa=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Wl=xa.reduce((t,e,r)=>(t[r]=e,t),[]),kl=xa.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Yl(t){return t.reduce((e,r)=>(e+=Wl[r],e),"")}function Jl(t){const e=[];for(const r of t){const i=kl[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Xl=ti({prefix:"🚀",name:"base256emoji",encode:Yl,decode:Jl});var Zl=Object.freeze({__proto__:null,base256emoji:Xl}),Ql=Ia,an=128,ef=127,tf=~ef,rf=Math.pow(2,31);function Ia(t,e,r){e=e||[],r=r||0;for(var i=r;t>=rf;)e[r++]=t&255|an,t/=128;for(;t&tf;)e[r++]=t&255|an,t>>>=7;return e[r]=t|0,Ia.bytes=r-i+1,e}var sf=Ri,nf=128,on=127;function Ri(t,i){var r=0,i=i||0,s=0,o=i,u,c=t.length;do{if(o>=c)throw Ri.bytes=0,new RangeError("Could not decode varint");u=t[o++],r+=s<28?(u&on)<<s:(u&on)*Math.pow(2,s),s+=7}while(u>=nf);return Ri.bytes=o-i,r}var af=Math.pow(2,7),of=Math.pow(2,14),cf=Math.pow(2,21),hf=Math.pow(2,28),uf=Math.pow(2,35),lf=Math.pow(2,42),ff=Math.pow(2,49),df=Math.pow(2,56),gf=Math.pow(2,63),pf=function(t){return t<af?1:t<of?2:t<cf?3:t<hf?4:t<uf?5:t<lf?6:t<ff?7:t<df?8:t<gf?9:10},yf={encode:Ql,decode:sf,encodingLength:pf},Oa=yf;const cn=(t,e,r=0)=>(Oa.encode(t,e,r),e),hn=t=>Oa.encodingLength(t),Ui=(t,e)=>{const r=e.byteLength,i=hn(t),s=i+hn(r),o=new Uint8Array(s+r);return cn(t,o,0),cn(r,o,i),o.set(e,s),new _f(t,r,e,o)};class _f{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Na=({name:t,code:e,encode:r})=>new wf(t,e,r);class wf{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ui(this.code,r):r.then(i=>Ui(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ta=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),mf=Na({name:"sha2-256",code:18,encode:Ta("SHA-256")}),bf=Na({name:"sha2-512",code:19,encode:Ta("SHA-512")});var vf=Object.freeze({__proto__:null,sha256:mf,sha512:bf});const Aa=0,Ef="identity",Pa=Ea,Sf=t=>Ui(Aa,Pa(t)),xf={code:Aa,name:Ef,encode:Pa,digest:Sf};var If=Object.freeze({__proto__:null,identity:xf});new TextEncoder,new TextDecoder;const un={...yl,...wl,...bl,...El,...Il,...Cl,...$l,...Hl,...Gl,...Zl};({...vf,...If});function Of(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Ra(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ln=Ra("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),di=Ra("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Of(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Nf={utf8:ln,"utf-8":ln,hex:un.base16,latin1:di,ascii:di,binary:di,...un};function Tf(t,e="utf8"){const r=Nf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}const Ua="wc",Af=2,Xi="core",Dt=`${Ua}@${2}:${Xi}:`,Pf={name:Xi,logger:"error"},Rf={database:":memory:"},Uf="crypto",fn="client_ed25519_seed",Lf=Z.ONE_DAY,Ff="keychain",Cf="0.3",Mf="messages",Df="0.3",$f=Z.SIX_HOURS,jf="publisher",La="irn",zf="error",Hf="wss://relay.walletconnect.com",qf="relayer",it={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Kf="_subscription",Dr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},dn=Z.ONE_SECOND,Bf="2.2.1",Vf="0.3",St={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Gf="subscription",Wf="0.3",kf=Z.FIVE_SECONDS*1e3,Yf="pairing",Jf="0.3",yr={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},Et={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Xf="history",Zf="0.3",Qf="expirer",pt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},ed="0.3";class td{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=Ff,this.version=Cf,this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:o}=B("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(o)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=xe.generateChildLogger(r,this.name)}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,pa(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ya(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class rd{constructor(e,r,i){this.core=e,this.logger=r,this.name=Uf,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),o=Ds(s);return ta(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Jh();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const o=await this.getClientSeed(),u=Ds(o),c=Ni();return await uh(c,s,Lf,u)},this.generateSharedKey=(s,o,u)=>{this.isInitialized();const c=this.getPrivateKey(s),h=Xh(c,o);return this.setSymKey(h,u)},this.setSymKey=async(s,o)=>{this.isInitialized();const u=o||Zh(s);return await this.keychain.set(u,s),u},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,o,u)=>{this.isInitialized();const c=da(u),h=Li(o);if(Gs(c)){const P=c.senderPublicKey,v=c.receiverPublicKey;s=await this.generateSharedKey(P,v)}const m=this.getSymKey(s),{type:w,senderPublicKey:E}=c;return eu({type:w,symKey:m,message:h,senderPublicKey:E})},this.decode=async(s,o,u)=>{this.isInitialized();const c=iu(o,u);if(Gs(c)){const w=c.receiverPublicKey,E=c.senderPublicKey;s=await this.generateSharedKey(w,E)}const h=this.getSymKey(s),m=tu({symKey:h,encoded:o});return Mn(m)},this.core=e,this.logger=xe.generateChildLogger(r,this.name),this.keychain=i||new td(this.core,this.logger)}get context(){return xe.getLoggerContext(this.logger)}getPayloadType(e){const r=Wi(e);return Or(r.type)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(fn)}catch{e=Ni(),await this.keychain.set(fn,e)}return Tf(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class id extends pc{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=Mf,this.version=Df,this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const o=Ti(s);let u=this.messages.get(i);return typeof u>"u"&&(u={}),typeof u[o]<"u"||(u[o]=s,this.messages.set(i,u),await this.persist()),o},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const o=this.get(i),u=Ti(s);return typeof o[u]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=xe.generateChildLogger(e,this.name),this.core=r}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,pa(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ya(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class sd extends yc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new yt.EventEmitter,this.name=jf,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,s,o)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:o}});try{const u=(o==null?void 0:o.ttl)||$f,c=Ai(o),h=(o==null?void 0:o.prompt)||!1,m=(o==null?void 0:o.tag)||0,w={topic:i,message:s,opts:{ttl:u,relay:c,prompt:h,tag:m}},E=Ti(s);this.queue.set(E,w);try{await await _a(this.rpcPublish(i,s,u,c,h,m),this.publishTimeout),this.relayer.events.emit(it.publish,w)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(it.connection_stalled);return}this.onPublish(E,w),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:o}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=xe.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return xe.getLoggerContext(this.logger)}rpcPublish(e,r,i,s,o,u){var c,h,m,w;const E={method:Pi(s.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:o,tag:u}};return lt((c=E.params)==null?void 0:c.prompt)&&((h=E.params)==null||delete h.prompt),lt((m=E.params)==null?void 0:m.tag)&&((w=E.params)==null||delete w.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.provider.request(E)}onPublish(e,r){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:s}=e;await this.publish(r,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(xr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class nd{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(o=>o!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var ad=Object.defineProperty,od=Object.defineProperties,cd=Object.getOwnPropertyDescriptors,gn=Object.getOwnPropertySymbols,hd=Object.prototype.hasOwnProperty,ud=Object.prototype.propertyIsEnumerable,pn=(t,e,r)=>e in t?ad(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$r=(t,e)=>{for(var r in e||(e={}))hd.call(e,r)&&pn(t,r,e[r]);if(gn)for(var r of gn(e))ud.call(e,r)&&pn(t,r,e[r]);return t},gi=(t,e)=>od(t,cd(e));class ld extends mc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new nd,this.events=new yt.EventEmitter,this.name=Gf,this.version=Wf,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Dt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=Ai(s),u={topic:i,relay:o};this.pending.set(i,u);const c=await this.rpcSubscribe(i,o);return this.onSubscribe(c,u),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,o)=>{const u=new Z.Watch;u.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),s(!0)),u.elapsed(this.pendingSubscriptionWatchLabel)>=kf&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),o(!1))},this.pendingSubInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=xe.generateChildLogger(r,this.name)}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Ai(i);await this.rpcUnsubscribe(e,r,s);const o=Je("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r){const i={method:Pi(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await _a(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(it.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:Pi(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,r){this.setSubscription(e,gi($r({},r),{id:e})),this.pending.delete(r.topic)}onResubscribe(e,r){this.addSubscription(e,gi($r({},r),{id:e})),this.pending.delete(r.topic)}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,$r({},r)),this.topicMap.set(r.topic,e),this.events.emit(St.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(St.deleted,gi($r({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(St.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(St.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:r,relay:i}=e,s={topic:r,relay:i};this.pending.set(s.topic,s);const o=await this.rpcSubscribe(s.topic,s.relay);this.onResubscribe(o,s)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const r=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(r,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(xr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(it.connect,async()=>{await this.onConnect()}),this.relayer.on(it.disconnect,()=>{this.onDisconnect()}),this.events.on(St.created,async e=>{const r=St.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(St.deleted,async e=>{const r=St.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var fd=Object.defineProperty,yn=Object.getOwnPropertySymbols,dd=Object.prototype.hasOwnProperty,gd=Object.prototype.propertyIsEnumerable,_n=(t,e,r)=>e in t?fd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pd=(t,e)=>{for(var r in e||(e={}))dd.call(e,r)&&_n(t,r,e[r]);if(yn)for(var r of yn(e))gd.call(e,r)&&_n(t,r,e[r]);return t};class yd extends _c{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new yt.EventEmitter,this.name=qf,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?xe.generateChildLogger(e.logger,this.name):Er(xe.getDefaultLoggerOptions({level:e.logger||zf})),this.messages=new id(this.logger,e.core),this.subscriber=new ld(this,this.logger),this.publisher=new sd(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Hf,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return xe.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r})}async subscribe(e,r){this.isInitialized();let i="";return await Promise.all([new Promise(s=>{this.subscriber.once(St.created,o=>{o.topic===e&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(e,r),s()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&await this.provider.disconnect(),this.events.emit(it.transport_closed)}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(St.resubscribed,()=>{r()})}),await Promise.race([this.provider.connect(),new Promise((r,i)=>this.once(it.transport_closed,()=>{i()}))])])}catch(r){const i=r;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(it.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(r=>setTimeout(r,dn)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new Ci(new rl(_u({sdkVersion:Bf,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;return await this.subscriber.isSubscribed(r)?this.messages.has(r,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Mi(e)){if(!e.method.endsWith(Kf))return;const r=e.params,{topic:i,message:s}=r.data,o={topic:i,message:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(pd({type:"event",event:r.id},o)),this.events.emit(r.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(it.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Di(e.id,!0);await this.provider.connection.send(r)}registerEventListeners(){this.provider.on(Dr.payload,e=>this.onProviderPayload(e)),this.provider.on(Dr.connect,()=>{this.events.emit(it.connect)}),this.provider.on(Dr.disconnect,()=>{this.events.emit(it.disconnect),this.attemptToReconnect()}),this.provider.on(Dr.error,e=>this.events.emit(it.error,e)),this.events.on(it.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Z.toMiliseconds(dn))}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var _d=Object.defineProperty,wn=Object.getOwnPropertySymbols,wd=Object.prototype.hasOwnProperty,md=Object.prototype.propertyIsEnumerable,mn=(t,e,r)=>e in t?_d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bn=(t,e)=>{for(var r in e||(e={}))wd.call(e,r)&&mn(t,r,e[r]);if(wn)for(var r of wn(e))md.call(e,r)&&mn(t,r,e[r]);return t};class ri extends wc{constructor(e,r,i,s=Dt,o=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=Vf,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(u=>{$u(u)?this.map.set(u.id,u):ju(u)?this.map.set(u.topic,u):this.getKey&&u!==null&&!lt(u)&&this.map.set(this.getKey(u),u)}),this.cached=[],this.initialized=!0)},this.set=async(u,c)=>{this.isInitialized(),this.map.has(u)?await this.update(u,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:u,value:c}),this.map.set(u,c),await this.persist())},this.get=u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:u}),this.getData(u)),this.getAll=u=>(this.isInitialized(),u?this.values.filter(c=>Object.keys(u).every(h=>Gr(c[h],u[h]))):this.values),this.update=async(u,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:u,update:c});const h=bn(bn({},this.getData(u)),c);this.map.set(u,h),await this.persist()},this.delete=async(u,c)=>{this.isInitialized(),this.map.has(u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:u,reason:c}),this.map.delete(u),await this.persist())},this.logger=xe.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=o}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class bd{constructor(e,r){this.core=e,this.logger=r,this.name=Yf,this.version=Jf,this.events=new yt,this.initialized=!1,this.storagePrefix=Dt,this.ignoredPayloadTypes=[Xt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Ni(),s=await this.core.crypto.setSymKey(i),o=xt(Z.FIVE_MINUTES),u={protocol:La},c={topic:s,expiry:o,relay:u,active:!1},h=Tu({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:u});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,o),{topic:s,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:o,relay:u}=Ou(i.uri),c=xt(Z.FIVE_MINUTES),h={topic:s,relay:u,expiry:c,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(o,s),await this.core.relayer.subscribe(s,{relay:u}),this.core.expirer.set(s,c),i.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:i})=>{this.isInitialized();const s=xt(Z.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const o=await this.sendRequest(s,"wc_pairingPing",{}),{done:u,resolve:c,reject:h}=Wt();this.events.once(Ce("pairing_ping",o),({error:m})=>{m?h(m):c()}),await u()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Je("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,o)=>{const u=$i(s,o),c=await this.core.crypto.encode(i,u),h=yr[s].req;return this.core.history.set(i,u),await this.core.relayer.publish(i,c,h),u.id},this.sendResult=async(i,s,o)=>{const u=Di(i,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),m=yr[h.request.method].res;await this.core.relayer.publish(s,c,m),await this.core.history.resolve(u)},this.sendError=async(i,s,o)=>{const u=Fi(i,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),m=yr[h.request.method]?yr[h.request.method].res:yr.unregistered_method.res;await this.core.relayer.publish(s,c,m),await this.core.history.resolve(u)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Je("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>Mt(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:o}=i,u=o.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingRequest(s,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,o);default:return this.onUnknownRpcMethodRequest(s,o)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:o}=i,u=(await this.core.history.get(s,o.id)).request.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingResponse(s,o);default:return this.onUnknownRpcMethodResponse(u)}},this.onPairingPingRequest=async(i,s)=>{const{id:o}=s;try{this.isValidPing({topic:i}),await this.sendResult(o,i,!0),this.events.emit("pairing_ping",{id:o,topic:i})}catch(u){await this.sendError(o,i,u),this.logger.error(u)}},this.onPairingPingResponse=(i,s)=>{const{id:o}=s;setTimeout(()=>{Ct(s)?this.events.emit(Ce("pairing_ping",o),{}):Pt(s)&&this.events.emit(Ce("pairing_ping",o),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:i}),await this.sendResult(o,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:o,topic:i})}catch(u){await this.sendError(o,i,u),this.logger.error(u)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:o,method:u}=s;try{if(this.registeredMethods.includes(u))return;const c=Je("WC_METHOD_UNSUPPORTED",u);await this.sendError(o,i,c),this.logger.error(c)}catch(c){await this.sendError(o,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Je("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!st(i)){const{message:s}=B("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!Du(i.uri)){const{message:s}=B("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!st(i)){const{message:o}=B("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!st(i)){const{message:o}=B("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Ze(i,!1)){const{message:s}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Mt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=B("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=xe.generateChildLogger(r,this.name),this.pairings=new ri(this.core,this.logger,this.name,this.storagePrefix)}get context(){return xe.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(it.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(r,i);Mi(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Dn(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:r,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(pt.expired,async e=>{const{topic:r}=ma(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class vd extends gc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new yt.EventEmitter,this.name=Xf,this.version=Zf,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:o}),this.records.has(s.id))return;const u={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:o};this.records.set(u.id,u),this.events.emit(Et.created,u)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Pt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(Et.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===i){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit(Et.deleted,o)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=xe.generateChildLogger(r,this.name)}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:$i(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Et.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Et.created,e=>{const r=Et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Et.updated,e=>{const r=Et.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Et.deleted,e=>{const r=Et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ed extends bc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new yt.EventEmitter,this.name=Qf,this.version=ed,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const o=this.formatTarget(i),u={target:o,expiry:s};this.expirations.set(o,u),this.checkExpiry(o,u),this.events.emit(pt.created,{target:o,expiration:u})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit(pt.deleted,{target:s,expiration:o})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=xe.generateChildLogger(r,this.name)}get context(){return xe.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return wu(e);if(typeof e=="number")return mu(e);const{message:r}=B("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(pt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Z.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(pt.expired,{target:e,expiration:r})}checkExpirations(){this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(xr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(pt.created,e=>{const r=pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(pt.expired,e=>{const r=pt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(pt.deleted,e=>{const r=pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Sd=Object.defineProperty,vn=Object.getOwnPropertySymbols,xd=Object.prototype.hasOwnProperty,Id=Object.prototype.propertyIsEnumerable,En=(t,e,r)=>e in t?Sd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sn=(t,e)=>{for(var r in e||(e={}))xd.call(e,r)&&En(t,r,e[r]);if(vn)for(var r of vn(e))Id.call(e,r)&&En(t,r,e[r]);return t};class Zi extends dc{constructor(e){super(e),this.protocol=Ua,this.version=Af,this.name=Xi,this.events=new yt.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(xe.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Pf.logger}));this.logger=xe.generateChildLogger(r,this.name),this.heartbeat=new xr.HeartBeat,this.crypto=new rd(this,this.logger,e==null?void 0:e.keychain),this.history=new vd(this,this.logger),this.expirer=new Ed(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Zo(Sn(Sn({},Rf),e==null?void 0:e.storageOptions)),this.relayer=new yd({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new bd(this,this.logger)}static async init(e){const r=new Zi(e);return await r.initialize(),r}get context(){return xe.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Od=Zi,Fa="wc",Ca=2,Ma="client",Qi=`${Fa}@${Ca}:${Ma}:`,pi={name:Ma,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Nd="proposal",Td="session",jr=Z.SEVEN_DAYS,Ad="engine",_r={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1115}}},yi={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},Pd="request";var Rd=Object.defineProperty,Ud=Object.defineProperties,Ld=Object.getOwnPropertyDescriptors,xn=Object.getOwnPropertySymbols,Fd=Object.prototype.hasOwnProperty,Cd=Object.prototype.propertyIsEnumerable,In=(t,e,r)=>e in t?Rd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,At=(t,e)=>{for(var r in e||(e={}))Fd.call(e,r)&&In(t,r,e[r]);if(xn)for(var r of xn(e))Cd.call(e,r)&&In(t,r,e[r]);return t},_i=(t,e)=>Ud(t,Ld(e));class Md extends Ec{constructor(e){super(e),this.name=Ad,this.events=new yt,this.initialized=!1,this.ignoredPayloadTypes=[Xt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(_r)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized(),await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:s,relays:o}=r;let u=i,c,h=!1;if(u&&(h=this.client.core.pairing.pairings.get(u).active),!u||!h){const{topic:R,uri:$}=await this.client.core.pairing.create();u=R,c=$}const m=await this.client.core.crypto.generateKeyPair(),w={requiredNamespaces:s,relays:o??[{protocol:La}],proposer:{publicKey:m,metadata:this.client.metadata}},{reject:E,resolve:P,done:v}=Wt();if(this.events.once(Ce("session_connect"),async({error:R,session:$})=>{if(R)E(R);else if($){$.self.publicKey=m;const l=_i(At({},$),{requiredNamespaces:$.requiredNamespaces});await this.client.session.set($.topic,l),await this.setExpiry($.topic,$.expiry),u&&await this.client.core.pairing.updateMetadata({topic:u,metadata:$.peer.metadata}),P(l)}}),!u){const{message:R}=B("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(R)}const N=await this.sendRequest(u,"wc_sessionPropose",w),C=xt(Z.FIVE_MINUTES);return await this.setProposal(N,At({id:N,expiry:C},w)),{uri:c,approval:v}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:s,namespaces:o}=r,u=this.client.proposal.get(i);let{pairingTopic:c,proposer:h,requiredNamespaces:m}=u;Vr(m)||(m=Uu(o,"approve()"),this.client.proposal.set(i,_i(At({},u),{requiredNamespaces:m})));const w=await this.client.core.crypto.generateKeyPair(),E=h.publicKey,P=await this.client.core.crypto.generateSharedKey(w,E),v={relay:{protocol:s??"irn"},namespaces:o,requiredNamespaces:m,controller:{publicKey:w,metadata:this.client.metadata},expiry:xt(jr)};await this.client.core.relayer.subscribe(P);const N=await this.sendRequest(P,"wc_sessionSettle",v),{done:C,resolve:R,reject:$}=Wt();this.events.once(Ce("session_approve",N),({error:_})=>{_?$(_):R(this.client.session.get(P))});const l=_i(At({},v),{topic:P,acknowledged:!1,self:v.controller,peer:{publicKey:h.publicKey,metadata:h.metadata},controller:w});return await this.client.session.set(P,l),await this.setExpiry(P,xt(jr)),c&&await this.client.core.pairing.updateMetadata({topic:c,metadata:l.peer.metadata}),c&&i&&(await this.sendResult(i,c,{relay:{protocol:s??"irn"},responderPublicKey:w}),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:c})),{topic:P,acknowledged:C}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:s}=r,{pairingTopic:o}=this.client.proposal.get(i);o&&(await this.sendError(i,o,s),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:s}=r,o=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:u,resolve:c,reject:h}=Wt();return this.events.once(Ce("session_update",o),({error:m})=>{m?h(m):c()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:u}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:o,resolve:u,reject:c}=Wt();return this.events.once(Ce("session_extend",s),({error:h})=>{h?c(h):u()}),await this.setExpiry(i,xt(jr)),{acknowledged:o}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:s,topic:o,expiry:u}=r,c=await this.sendRequest(o,"wc_sessionRequest",{request:s,chainId:i},u),{done:h,resolve:m,reject:w}=Wt(u);return this.events.once(Ce("session_request",c),({error:E,result:P})=>{E?w(E):m(P)}),await h()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:o}=s;Ct(s)?await this.sendResult(o,i,s.result):Pt(s)&&await this.sendError(o,i,s.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:o,resolve:u,reject:c}=Wt();this.events.once(Ce("session_ping",s),({error:h})=>{h?c(h):u()}),await o()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:s,chainId:o}=r;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:o})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",Je("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Cu(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(r,i)=>{const{self:s}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,Je("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(r),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,Je("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=_r.wc_sessionRequest.req.ttl,{id:s,topic:o,params:u}=r;await this.client.pendingRequest.set(s,{id:s,topic:o,params:u}),i&&this.client.core.expirer.set(s,xt(i))},this.sendRequest=async(r,i,s,o)=>{const u=$i(i,s),c=await this.client.core.crypto.encode(r,u),h=_r[i].req;return o&&(h.ttl=o),this.client.core.history.set(r,u),this.client.core.relayer.publish(r,c,h),u.id},this.sendResult=async(r,i,s)=>{const o=Di(r,s),u=await this.client.core.crypto.encode(i,o),c=await this.client.core.history.get(i,r),h=_r[c.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(o)},this.sendError=async(r,i,s)=>{const o=Fi(r,s),u=await this.client.core.crypto.encode(i,o),c=await this.client.core.history.get(i,r),h=_r[c.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(o)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{Mt(s.expiry)&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Mt(s.expiry)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=r=>{const{topic:i,payload:s}=r,o=s.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${o}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:s}=r,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onSessionProposeRequest=async(r,i)=>{const{params:s,id:o}=i;try{this.isValidConnect(At({},i.params));const u=xt(Z.FIVE_MINUTES),c=At({id:o,pairingTopic:r,expiry:u},s);await this.setProposal(o,c),this.client.events.emit("session_proposal",{id:o,params:c})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionProposeResponse=async(r,i)=>{const{id:s}=i;if(Ct(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const u=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const c=u.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const m=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:m});const w=await this.client.core.relayer.subscribe(m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:w}),await this.client.core.pairing.activate({topic:r})}else Pt(i)&&(await this.client.proposal.delete(s,Je("USER_DISCONNECTED")),this.events.emit(Ce("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:s,params:o}=i;try{this.isValidSessionSettleRequest(o);const{relay:u,controller:c,expiry:h,namespaces:m,requiredNamespaces:w}=i.params,E={topic:r,relay:u,expiry:h,namespaces:m,acknowledged:!0,requiredNamespaces:w,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}};await this.sendResult(i.id,r,!0),this.events.emit(Ce("session_connect"),{session:E})}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.onSessionSettleResponse=async(r,i)=>{const{id:s}=i;Ct(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ce("session_approve",s),{})):Pt(i)&&(await this.client.session.delete(r,Je("USER_DISCONNECTED")),this.events.emit(Ce("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:s,id:o}=i;try{this.isValidUpdate(At({topic:r},s)),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult(o,r,!0),this.client.events.emit("session_update",{id:o,topic:r,params:s})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionUpdateResponse=(r,i)=>{const{id:s}=i;Ct(i)?this.events.emit(Ce("session_update",s),{}):Pt(i)&&this.events.emit(Ce("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,xt(jr)),await this.sendResult(s,r,!0),this.client.events.emit("session_extend",{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.onSessionExtendResponse=(r,i)=>{const{id:s}=i;Ct(i)?this.events.emit(Ce("session_extend",s),{}):Pt(i)&&this.events.emit(Ce("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.client.events.emit("session_ping",{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.onSessionPingResponse=(r,i)=>{const{id:s}=i;setTimeout(()=>{Ct(i)?this.events.emit(Ce("session_ping",s),{}):Pt(i)&&this.events.emit(Ce("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await this.sendResult(s,r,!0),await this.deleteSession(r),this.client.events.emit("session_delete",{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.onSessionRequest=async(r,i)=>{const{id:s,params:o}=i;try{this.isValidRequest(At({topic:r},o)),await this.setPendingSessionRequest({id:s,topic:r,params:o}),this.client.events.emit("session_request",{id:s,topic:r,params:o})}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.onSessionRequestResponse=(r,i)=>{const{id:s}=i;Ct(i)?this.events.emit(Ce("session_request",s),{result:i.result}):Pt(i)&&this.events.emit(Ce("session_request",s),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:s,params:o}=i;try{this.isValidEmit(At({topic:r},o)),this.client.events.emit("session_event",{id:s,topic:r,params:o})}catch(u){await this.sendError(s,r,u),this.client.logger.error(u)}},this.isValidConnect=async r=>{if(!st(r)){const{message:c}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(c)}const{pairingTopic:i,requiredNamespaces:s,relays:o}=r;if(lt(i)||await this.isValidPairingTopic(i),!lt(s)&&Vr(s)===0)return;const u=Ku(s,"connect()");if(u)throw new Error(u.message);if(!Bu(o,!0)){const{message:c}=B("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(c)}},this.isValidApprove=async r=>{if(!st(r))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:o}=r;await this.isValidProposalId(i);const u=this.client.proposal.get(i),c=zr(s,"approve()");if(c)throw new Error(c.message);const h=sn(u.requiredNamespaces,s,"update()");if(h)throw new Error(h.message);if(!Ze(o,!0)){const{message:m}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${o}`);throw new Error(m)}},this.isValidReject=async r=>{if(!st(r)){const{message:o}=B("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(o)}const{id:i,reason:s}=r;if(await this.isValidProposalId(i),!Gu(s)){const{message:o}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidSessionSettleRequest=r=>{if(!st(r)){const{message:m}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(m)}const{relay:i,controller:s,namespaces:o,expiry:u}=r;if(!va(i)){const{message:m}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(m)}const c=zu(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=zr(o,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Mt(u)){const{message:m}=B("EXPIRED","onSessionSettleRequest()");throw new Error(m)}},this.isValidUpdate=async r=>{if(!st(r)){const{message:h}=B("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(h)}const{topic:i,namespaces:s}=r;await this.isValidSessionTopic(i);const o=this.client.session.get(i),u=zr(s,"update()");if(u)throw new Error(u.message);const c=sn(o.requiredNamespaces,s,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!st(r)){const{message:s}=B("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!st(r)){const{message:h}=B("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(h)}const{topic:i,request:s,chainId:o,expiry:u}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!rn(c,o)){const{message:h}=B("MISSING_OR_INVALID",`request() chainId: ${o}`);throw new Error(h)}if(!Wu(s)){const{message:h}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(h)}if(!Ju(c,o,s.method)){const{message:h}=B("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(h)}if(u&&!Zu(u,yi)){const{message:h}=B("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${yi.min} and ${yi.max}`);throw new Error(h)}},this.isValidRespond=async r=>{if(!st(r)){const{message:o}=B("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:i,response:s}=r;if(await this.isValidSessionTopic(i),!ku(s)){const{message:o}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidPing=async r=>{if(!st(r)){const{message:s}=B("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!st(r)){const{message:c}=B("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:s,chainId:o}=r;await this.isValidSessionTopic(i);const{namespaces:u}=this.client.session.get(i);if(!rn(u,o)){const{message:c}=B("MISSING_OR_INVALID",`emit() chainId: ${o}`);throw new Error(c)}if(!Yu(s)){const{message:c}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}if(!Xu(u,o,s.name)){const{message:c}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!st(r)){const{message:s}=B("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(it.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(r,i);Mi(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Dn(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:r,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(pt.expired,async e=>{const{topic:r,id:i}=ma(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,B("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&await this.deleteProposal(i,!0)})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:r}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=B("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:r}=B("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=B("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:r}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Vu(e)){const{message:r}=B("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=B("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class Dd extends ri{constructor(e,r){super(e,r,Nd,Qi),this.core=e,this.logger=r}}class $d extends ri{constructor(e,r){super(e,r,Td,Qi),this.core=e,this.logger=r}}class jd extends ri{constructor(e,r){super(e,r,Pd,Qi),this.core=e,this.logger=r}}let Da=class extends vc{constructor(e){super(e),this.protocol=Fa,this.version=Ca,this.name=pi.name,this.events=new yt.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||pi.name,this.metadata=(e==null?void 0:e.metadata)||du();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(xe.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||pi.logger}));this.core=(e==null?void 0:e.core)||new Od(e),this.logger=xe.generateChildLogger(r,this.name),this.session=new $d(this.core,this.logger),this.proposal=new Dd(this.core,this.logger),this.pendingRequest=new jd(this.core,this.logger),this.engine=new Md(this)}static async init(e){const r=new Da(e);return await r.initialize(),r}get context(){return xe.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.getLocalStorage=Oe.getLocalStorageOrThrow=Oe.getCrypto=Oe.getCryptoOrThrow=Oe.getLocation=Oe.getLocationOrThrow=Oe.getNavigator=Oe.getNavigatorOrThrow=Oe.getDocument=Oe.getDocumentOrThrow=Oe.getFromWindowOrThrow=Oe.getFromWindow=void 0;function Zt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Oe.getFromWindow=Zt;function ar(t){const e=Zt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Oe.getFromWindowOrThrow=ar;function zd(){return ar("document")}Oe.getDocumentOrThrow=zd;function Hd(){return Zt("document")}Oe.getDocument=Hd;function qd(){return ar("navigator")}Oe.getNavigatorOrThrow=qd;function Kd(){return Zt("navigator")}Oe.getNavigator=Kd;function Bd(){return ar("location")}Oe.getLocationOrThrow=Bd;function Vd(){return Zt("location")}Oe.getLocation=Vd;function Gd(){return ar("crypto")}Oe.getCryptoOrThrow=Gd;function Wd(){return Zt("crypto")}Oe.getCrypto=Wd;function kd(){return ar("localStorage")}Oe.getLocalStorageOrThrow=kd;function Yd(){return Zt("localStorage")}Oe.getLocalStorage=Yd;var es={};Object.defineProperty(es,"__esModule",{value:!0});es.getWindowMetadata=void 0;const On=Oe;function Jd(){let t,e;try{t=On.getDocumentOrThrow(),e=On.getLocationOrThrow()}catch{return null}function r(){const E=t.getElementsByTagName("link"),P=[];for(let v=0;v<E.length;v++){const N=E[v],C=N.getAttribute("rel");if(C&&C.toLowerCase().indexOf("icon")>-1){const R=N.getAttribute("href");if(R)if(R.toLowerCase().indexOf("https:")===-1&&R.toLowerCase().indexOf("http:")===-1&&R.indexOf("//")!==0){let $=e.protocol+"//"+e.host;if(R.indexOf("/")===0)$+=R;else{const l=e.pathname.split("/");l.pop();const _=l.join("/");$+=_+"/"+R}P.push($)}else if(R.indexOf("//")===0){const $=e.protocol+R;P.push($)}else P.push(R)}}return P}function i(...E){const P=t.getElementsByTagName("meta");for(let v=0;v<P.length;v++){const N=P[v],C=["itemprop","property","name"].map(R=>N.getAttribute(R)).filter(R=>R?E.includes(R):!1);if(C.length&&C){const R=N.getAttribute("content");if(R)return R}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=t.title),E}function o(){return i("description","og:description","twitter:description","keywords")}const u=s(),c=o(),h=e.origin,m=r();return{description:c,url:h,icons:m,name:u}}es.getWindowMetadata=Jd;var Xd={};(function(t){const e=Fn,r=Cn,i=Ln,s=ua,o=l=>l==null,u=Symbol("encodeFragmentIdentifier");function c(l){switch(l.arrayFormat){case"index":return _=>(f,g)=>{const y=f.length;return g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[w(_,l),"[",y,"]"].join("")]:[...f,[w(_,l),"[",w(y,l),"]=",w(g,l)].join("")]};case"bracket":return _=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[w(_,l),"[]"].join("")]:[...f,[w(_,l),"[]=",w(g,l)].join("")];case"colon-list-separator":return _=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[w(_,l),":list="].join("")]:[...f,[w(_,l),":list=",w(g,l)].join("")];case"comma":case"separator":case"bracket-separator":{const _=l.arrayFormat==="bracket-separator"?"[]=":"=";return f=>(g,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?g:(y=y===null?"":y,g.length===0?[[w(f,l),_,w(y,l)].join("")]:[[g,w(y,l)].join(l.arrayFormatSeparator)])}default:return _=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,w(_,l)]:[...f,[w(_,l),"=",w(g,l)].join("")]}}function h(l){let _;switch(l.arrayFormat){case"index":return(f,g,y)=>{if(_=/\[(\d*)\]$/.exec(f),f=f.replace(/\[\d*\]$/,""),!_){y[f]=g;return}y[f]===void 0&&(y[f]={}),y[f][_[1]]=g};case"bracket":return(f,g,y)=>{if(_=/(\[\])$/.exec(f),f=f.replace(/\[\]$/,""),!_){y[f]=g;return}if(y[f]===void 0){y[f]=[g];return}y[f]=[].concat(y[f],g)};case"colon-list-separator":return(f,g,y)=>{if(_=/(:list)$/.exec(f),f=f.replace(/:list$/,""),!_){y[f]=g;return}if(y[f]===void 0){y[f]=[g];return}y[f]=[].concat(y[f],g)};case"comma":case"separator":return(f,g,y)=>{const n=typeof g=="string"&&g.includes(l.arrayFormatSeparator),d=typeof g=="string"&&!n&&E(g,l).includes(l.arrayFormatSeparator);g=d?E(g,l):g;const U=n||d?g.split(l.arrayFormatSeparator).map(j=>E(j,l)):g===null?g:E(g,l);y[f]=U};case"bracket-separator":return(f,g,y)=>{const n=/(\[\])$/.test(f);if(f=f.replace(/\[\]$/,""),!n){y[f]=g&&E(g,l);return}const d=g===null?[]:g.split(l.arrayFormatSeparator).map(U=>E(U,l));if(y[f]===void 0){y[f]=d;return}y[f]=[].concat(y[f],d)};default:return(f,g,y)=>{if(y[f]===void 0){y[f]=g;return}y[f]=[].concat(y[f],g)}}}function m(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function w(l,_){return _.encode?_.strict?e(l):encodeURIComponent(l):l}function E(l,_){return _.decode?r(l):l}function P(l){return Array.isArray(l)?l.sort():typeof l=="object"?P(Object.keys(l)).sort((_,f)=>Number(_)-Number(f)).map(_=>l[_]):l}function v(l){const _=l.indexOf("#");return _!==-1&&(l=l.slice(0,_)),l}function N(l){let _="";const f=l.indexOf("#");return f!==-1&&(_=l.slice(f)),_}function C(l){l=v(l);const _=l.indexOf("?");return _===-1?"":l.slice(_+1)}function R(l,_){return _.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):_.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function $(l,_){_=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},_),m(_.arrayFormatSeparator);const f=h(_),g=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return g;for(const y of l.split("&")){if(y==="")continue;let[n,d]=i(_.decode?y.replace(/\+/g," "):y,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(_.arrayFormat)?d:E(d,_),f(E(n,_),d,g)}for(const y of Object.keys(g)){const n=g[y];if(typeof n=="object"&&n!==null)for(const d of Object.keys(n))n[d]=R(n[d],_);else g[y]=R(n,_)}return _.sort===!1?g:(_.sort===!0?Object.keys(g).sort():Object.keys(g).sort(_.sort)).reduce((y,n)=>{const d=g[n];return Boolean(d)&&typeof d=="object"&&!Array.isArray(d)?y[n]=P(d):y[n]=d,y},Object.create(null))}t.extract=C,t.parse=$,t.stringify=(l,_)=>{if(!l)return"";_=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},_),m(_.arrayFormatSeparator);const f=d=>_.skipNull&&o(l[d])||_.skipEmptyString&&l[d]==="",g=c(_),y={};for(const d of Object.keys(l))f(d)||(y[d]=l[d]);const n=Object.keys(y);return _.sort!==!1&&n.sort(_.sort),n.map(d=>{const U=l[d];return U===void 0?"":U===null?w(d,_):Array.isArray(U)?U.length===0&&_.arrayFormat==="bracket-separator"?w(d,_)+"[]":U.reduce(g(d),[]).join("&"):w(d,_)+"="+w(U,_)}).filter(d=>d.length>0).join("&")},t.parseUrl=(l,_)=>{_=Object.assign({decode:!0},_);const[f,g]=i(l,"#");return Object.assign({url:f.split("?")[0]||"",query:$(C(l),_)},_&&_.parseFragmentIdentifier&&g?{fragmentIdentifier:E(g,_)}:{})},t.stringifyUrl=(l,_)=>{_=Object.assign({encode:!0,strict:!0,[u]:!0},_);const f=v(l.url).split("?")[0]||"",g=t.extract(l.url),y=t.parse(g,{sort:!1}),n=Object.assign(y,l.query);let d=t.stringify(n,_);d&&(d=`?${d}`);let U=N(l.url);return l.fragmentIdentifier&&(U=`#${_[u]?w(l.fragmentIdentifier,_):l.fragmentIdentifier}`),`${f}${d}${U}`},t.pick=(l,_,f)=>{f=Object.assign({parseFragmentIdentifier:!0,[u]:!1},f);const{url:g,query:y,fragmentIdentifier:n}=t.parseUrl(l,f);return t.stringifyUrl({url:g,query:s(y,_),fragmentIdentifier:n},f)},t.exclude=(l,_,f)=>{const g=Array.isArray(_)?y=>!_.includes(y):(y,n)=>!_(y,n);return t.pick(l,g,f)}})(Xd);const Zd={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Nn(t,e){const{message:r,code:i}=Zd[t];return{message:e?`${r} ${e}`:r,code:i}}function Qd(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function eg(t){var e;const r=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[r.split(":")[0],r.split(":")[1]]}function Wr(t,e){let r;return e.rpcMap&&(r=e.rpcMap[tg([t])]),r}function tg(t){return Number(t[0].split(":")[1])}class rg{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var r;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=r||Wr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}createHttpProvider(e,r){const i=r||Wr(e,this.namespace);return typeof i>"u"?void 0:new Ci(new $n(i))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}}class ig{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Wr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Wr(e,this.namespace);return typeof i>"u"?void 0:new Ci(new $n(i))}}const Tn="error",sg="wss://relay.walletconnect.com",ng="wc",ag="universal_provider",An=`${ng}@${2}:${ag}:`;var og=Object.defineProperty,cg=Object.defineProperties,hg=Object.getOwnPropertyDescriptors,Pn=Object.getOwnPropertySymbols,ug=Object.prototype.hasOwnProperty,lg=Object.prototype.propertyIsEnumerable,Rn=(t,e,r)=>e in t?og(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Un=(t,e)=>{for(var r in e||(e={}))ug.call(e,r)&&Rn(t,r,e[r]);if(Pn)for(var r of Pn(e))lg.call(e,r)&&Rn(t,r,e[r]);return t},fg=(t,e)=>cg(t,hg(e));class ts{constructor(e){this.events=new yt,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Er(xe.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Tn}))}static async init(e){const r=new ts(e);return await r.initialize(),r}async request(e,r){var i;const[s,o]=this.validateChain(r);return await this.getProvider(s).request({request:Un({},e),chainId:`${s}:${o}`,topic:(i=this.session)==null?void 0:i.topic})}sendAsync(e,r,i){this.request(e,i).then(s=>r(null,s)).catch(s=>r(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return await this.request({method:"eth_requestAccounts",params:[]})}async disconnect(){if(!this.client)throw new Error("Sign Client not initialized");await this.client.disconnect({topic:this.session.topic,reason:Nn("USER_DISCONNECTED")})}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");return this.setNamespaces(e.namespaces),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return r&&(this.uri=r,this.events.emit("display_uri",r)),this.session=await i(),this.onSessionUpdate(),this.session}setDefaultChain(e,r){try{const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(){this.logger.info("Cleaning up inactive pairings...");const e=this.client.pairing.getAll({active:!1});!Qd(e)||(await Promise.all([e.map(r=>this.client.pairing.delete(r.topic,Nn("USER_DISCONNECTED"))),e.map(r=>this.client.core.relayer.unsubscribe(r.topic)),e.map(r=>this.client.core.expirer.del(r.topic))]),this.logger.info(`Inactive pairings cleared: ${e.length}`))}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${An}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Da.init({logger:this.providerOpts.logger||Tn,relayUrl:this.providerOpts.relayUrl||sg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new rg({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new ig({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:s}=r,o=(i=this.client)==null?void 0:i.session.get(e);this.session=fg(Un({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",()=>{this.events.emit("session_delete")})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>this.getProvider(e).updateNamespace(this.session.namespaces[e]))}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${An}/namespaces`,e),this.namespaces=e}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(r&&!Object.keys(this.namespaces).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);return!r||!i?eg(this.namespaces):[r,i]}}const Eg=ts;export{Eg as UniversalProvider,ts as default};
